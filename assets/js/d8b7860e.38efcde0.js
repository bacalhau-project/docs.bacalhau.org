"use strict";(self.webpackChunkbacalhau_docs=self.webpackChunkbacalhau_docs||[]).push([[9290],{2514:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var t=a(5893),s=a(1151);const i={sidebar_label:"Bacalhau Python SDK",sidebar_position:1},o="Bacalhau Python SDK :snake:",l={id:"references/sdk/python-sdk",title:"Bacalhau Python SDK :snake:",description:"This is the official Python SDK for Bacalhau, named bacalhau-sdk.",source:"@site/docs/references/sdk/python-sdk.md",sourceDirName:"references/sdk",slug:"/references/sdk/python-sdk",permalink:"/references/sdk/python-sdk",draft:!1,unlisted:!1,editUrl:"https://github.com/bacalhau-project/docs.bacalhau.org/blob/main/docs/references/sdk/python-sdk.md",tags:[],version:"current",lastUpdatedAt:1702044882,formattedLastUpdatedAt:"Dec 8, 2023",sidebarPosition:1,frontMatter:{sidebar_label:"Bacalhau Python SDK",sidebar_position:1},sidebar:"documentationSidebar",previous:{title:"SDK",permalink:"/category/sdk"},next:{title:"FAQS",permalink:"/troubleshooting"}},r={},c=[{value:"Features",id:"features",level:2},{value:"Install",id:"install",level:2},{value:"From PyPi:",id:"from-pypi",level:3},{value:"From source:",id:"from-source",level:3},{value:"Initialize",id:"initialize",level:2},{value:"Example Use",id:"example-use",level:2},{value:"Devstack",id:"devstack",level:2},{value:"Developers guide",id:"developers-guide",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.h1,{id:"bacalhau-python-sdk-snake",children:["Bacalhau Python SDK ","\ud83d\udc0d"]}),"\n",(0,t.jsxs)(n.p,{children:["This is the official Python SDK for Bacalhau, named ",(0,t.jsx)(n.code,{children:"bacalhau-sdk"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["It is a ",(0,t.jsx)(n.strong,{children:"high-level"})," SDK that ships the client-side logic (e.g. signing requests) needed to query the endpoints.\nPlease take a look at ",(0,t.jsx)(n.a,{href:"./examples",children:"the examples"})," for snippets to create, list and inspect jobs.\nUnder the hood, this SDK uses ",(0,t.jsx)(n.code,{children:"bacalhau-apiclient"})," (autogenerated via ",(0,t.jsx)(n.a,{href:"https://swagger.io/tools/swagger-codegen/",children:"Swagger"}),"/OpenAPI) to interact with the API."]}),"\n",(0,t.jsxs)(n.p,{children:["Please make sure to use this SDK library in your Python projects, instead of the lower level ",(0,t.jsx)(n.code,{children:"bacalhau-apiclient"}),".\nThe latter is listed as a dependency of this SDK and will be installed automatically when you follow the installation instructions below."]}),"\n",(0,t.jsx)(n.h2,{id:"features",children:"Features"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["List, create and inspect Bacalhau jobs using Python objects ","\ud83c\udf88"]}),"\n",(0,t.jsxs)(n.li,{children:["Use the production network, or set the following environment variables to target any Bacalhau network out there:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"BACALHAU_API_HOST"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"BACALHAU_API_PORT"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Generate a key pair used to sign requests stored in the path specified by the ",(0,t.jsx)(n.code,{children:"BACALHAU_DIR"})," env var (default: ",(0,t.jsx)(n.code,{children:"~/.bacalhau"}),")"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"install",children:"Install"}),"\n",(0,t.jsx)(n.h3,{id:"from-pypi",children:"From PyPi:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-console",children:"$ pip install bacalhau-sdk\n"})}),"\n",(0,t.jsx)(n.h3,{id:"from-source",children:"From source:"}),"\n",(0,t.jsx)(n.p,{children:"Clone the public repository:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-console",children:"$ git clone https://github.com/bacalhau-project/bacalhau/\n"})}),"\n",(0,t.jsx)(n.p,{children:"Once you have a copy of the source, you can install it with:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-console",children:"$ cd python/\n$ pip install .\n"})}),"\n",(0,t.jsx)(n.h2,{id:"initialize",children:"Initialize"}),"\n",(0,t.jsxs)(n.p,{children:["Likewise the Bacalhau CLI, this SDK uses a key pair to be stored in ",(0,t.jsx)(n.code,{children:"BACALHAU_DIR"})," used for signing requests.\nIf a key pair is not found there, it will create one for you."]}),"\n",(0,t.jsx)(n.h2,{id:"example-use",children:"Example Use"}),"\n",(0,t.jsxs)(n.p,{children:["Let's submit a Hello World job and then fetch its output data's CID.\nWe start by importing this sdk, namely ",(0,t.jsx)(n.code,{children:"bacalhau_sdk"}),", used to create and submit a job create request.\nThen we import ",(0,t.jsx)(n.code,{children:"bacalhau_apiclient"})," (installed automatically with this sdk), it provides various object models that compose a job create request.\nThese are used to populate a simple python dictionary that will be passed over to the ",(0,t.jsx)(n.code,{children:"submit"})," util method."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import pprint\n\nfrom bacalhau_sdk.api import submit\nfrom bacalhau_sdk.config import get_client_id\nfrom bacalhau_apiclient.models.storage_spec import StorageSpec\nfrom bacalhau_apiclient.models.spec import Spec\nfrom bacalhau_apiclient.models.job_spec_language import JobSpecLanguage\nfrom bacalhau_apiclient.models.job_spec_docker import JobSpecDocker\nfrom bacalhau_apiclient.models.job_sharding_config import JobShardingConfig\nfrom bacalhau_apiclient.models.job_execution_plan import JobExecutionPlan\nfrom bacalhau_apiclient.models.publisher_spec import PublisherSpec\nfrom bacalhau_apiclient.models.deal import Deal\n\n\ndata = dict(\n    APIVersion=\'V1beta1\',\n    ClientID=get_client_id(),\n    Spec=Spec(\n        engine="Docker",\n        verifier="Noop",\n        publisher_spec=PublisherSpec(type="Estuary"),\n        docker=JobSpecDocker(\n            image="ubuntu",\n            entrypoint=["echo", "Hello World!"],\n        ),\n        language=JobSpecLanguage(job_context=None),\n        wasm=None,\n        resources=None,\n        timeout=1800,\n        outputs=[\n            StorageSpec(\n                storage_source="IPFS",\n                name="outputs",\n                path="/outputs",\n            )\n        ],\n        sharding=JobShardingConfig(\n            batch_size=1,\n            glob_pattern_base_path="/inputs",\n        ),\n        execution_plan=JobExecutionPlan(shards_total=0),\n        deal=Deal(concurrency=1, confidence=0, min_bids=0),\n        do_not_track=False,\n    ),\n)\n\npprint.pprint(submit(data))\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The script above prints the following object, the ",(0,t.jsx)(n.code,{children:"job.metadata.id"})," value is our newly created job id!"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"{'job': {'api_version': 'V1beta1',\n         'metadata': {'client_id': 'bae9c3b2adfa04cc647a2457e8c0c605cef8ed93bdea5ac5f19f94219f722dfe',\n                      'created_at': '2023-02-01T19:30:21.405209538Z',\n                      'id': '710a0bc2-81d1-4025-8f80-5327ca3ce170'},\n         'spec': {'Deal': {'Concurrency': 1},\n                  'Docker': {'Entrypoint': ['echo', 'Hello World!'],\n                             'Image': 'ubuntu'},\n                  'Engine': 'Docker',\n                  'ExecutionPlan': {'ShardsTotal': 1},\n                  'Language': {'JobContext': {}},\n                  'Network': {'Type': 'None'},\n                  'Publisher': 'Estuary',\n                  'Resources': {'GPU': ''},\n                  'Sharding': {'BatchSize': 1,\n                               'GlobPatternBasePath': '/inputs'},\n                  'Timeout': 1800,\n                  'Verifier': 'Noop',\n                  'Wasm': {'EntryModule': {}},\n                  'outputs': [{'Name': 'outputs',\n                               'StorageSource': 'IPFS',\n                               'path': '/outputs'}]},\n         'status': {'JobState': {},\n                    'Requester': {'RequesterNodeID': 'QmdZQ7ZbhnvWY1J12XYKGHApJ6aufKyLNSvf8jZBrBaAVL',\n                                  'RequesterPublicKey': 'CAASpgIwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDVRKPgCfY2fgfrkHkFjeWcqno+MDpmp8DgVaY672BqJl/dZFNU9lBg2P8Znh8OTtHPPBUBk566vU3KchjW7m3uK4OudXrYEfSfEPnCGmL6GuLiZjLf+eXGEez7qPaoYqo06gD8ROdD8VVse27E96LlrpD1xKshHhqQTxKoq1y6Rx4DpbkSt966BumovWJ70w+Nt9ZkPPydRCxVnyWS1khECFQxp5Ep3NbbKtxHNX5HeULzXN5q0EQO39UN6iBhiI34eZkH7PoAm3Vk5xns//FjTAvQw6wZUu8LwvZTaihs+upx2zZysq6CEBKoeNZqed9+Tf+qHow0P5pxmiu+or+DAgMBAAE='}}}}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["We can then use the ",(0,t.jsx)(n.code,{children:"results"})," method to fetch, among other fields, the output data's CID."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from bacalhau_sdk.api import results\n\nprint(results(job_id="710a0bc2-81d1-4025-8f80-5327ca3ce170"))\n'})}),"\n",(0,t.jsx)(n.p,{children:"The line above prints the following dictionary:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"{'results': [{'data': {'cid': 'QmYEqqNDdDrsRhPRShKHzsnZwBq3F59Ti3kQmv9En4i5Sw',\n                       'metadata': None,\n                       'name': 'job-710a0bc2-81d1-4025-8f80-5327ca3ce170-shard-0-host-QmYgxZiySj3MRkwLSL4X2MF5F9f2PMhAE3LV49XkfNL1o3',\n                       'path': None,\n                       'source_path': None,\n                       'storage_source': 'IPFS',\n                       'url': None},\n              'node_id': 'QmYgxZiySj3MRkwLSL4X2MF5F9f2PMhAE3LV49XkfNL1o3',\n              'shard_index': None}]}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Congrats, that was a good start! \ud83c\udf88\nPlease find more code snippets in ",(0,t.jsx)(n.a,{href:"./examples",children:"the examples folder"})," (more examples published in the near future)."]}),"\n",(0,t.jsx)(n.h2,{id:"devstack",children:"Devstack"}),"\n",(0,t.jsxs)(n.p,{children:["You can set the environment variables ",(0,t.jsx)(n.code,{children:"BACALHAU_API_HOST"})," and ",(0,t.jsx)(n.code,{children:"BACALHAU_API_PORT"})," to point this SDK to your Bacalhau API local devstack"]}),"\n",(0,t.jsx)(n.h2,{id:"developers-guide",children:"Developers guide"}),"\n",(0,t.jsxs)(n.p,{children:["We use Poetry to manage this package, take a look at ",(0,t.jsx)(n.a,{href:"https://python-poetry.org/docs/",children:"their official docs"})," to install it.\nNote, all targets in the Makefile use poetry as well!"]}),"\n",(0,t.jsxs)(n.p,{children:["To develop this SDK locally, create a dedicated poetry virtual environment and install the root package (i.e. ",(0,t.jsx)(n.code,{children:"bacalhau_sdk"}),") and its dependencies:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ poetry install --no-interaction --with test,dev -vvv\nCreating virtualenv bacalhau-sdk-9mIcLX8U-py3.9 in /Users/enricorotundo/Library/Caches/pypoetry/virtualenvs\nUsing virtualenv: /Users/enricorotundo/Library/Caches/pypoetry/virtualenvs/bacalhau-sdk-9mIcLX8U-py3.9\nInstalling dependencies from lock file\n...\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Note the line above installs the root package (i.e. ",(0,t.jsx)(n.code,{children:"bacalhau_sdk"}),") in editable mode, that is, any change to its source code is reflected immediately without the need for re-packaging and re-installing it. Easy peasy!"]}),"\n",(0,t.jsx)(n.p,{children:"Then install the pre-commit hooks and test it:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"$ make install-pre-commit\n\n$ make pre-commit\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},1151:(e,n,a)=>{a.d(n,{Z:()=>l,a:()=>o});var t=a(7294);const s={},i=t.createContext(s);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);