"use strict";(self.webpackChunkbacalhau_docs=self.webpackChunkbacalhau_docs||[]).push([[3958],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>b});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=u(n),m=a,b=p["".concat(s,".").concat(m)]||p[m]||c[m]||o;return n?r.createElement(b,i(i({ref:t},d),{},{components:n})):r.createElement(b,i({ref:t},d))}));function b(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:a,i[1]=l;for(var u=2;u<o;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},4545:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>l,toc:()=>u});var r=n(7462),a=(n(7294),n(3905));const o={sidebar_label:"Configuring node persistence",sidebar_position:180,title:"Configuring node persistence",description:"How to configure compute/requester persistence"},i=void 0,l={unversionedId:"running-node/persistence",id:"running-node/persistence",title:"Configuring node persistence",description:"How to configure compute/requester persistence",source:"@site/docs/running-node/persistence.md",sourceDirName:"running-node",slug:"/running-node/persistence",permalink:"/running-node/persistence",draft:!1,editUrl:"https://github.com/bacalhau-project/docs.bacalhau.org/blob/main/docs/running-node/persistence.md",tags:[],version:"current",lastUpdatedAt:1697636387,formattedLastUpdatedAt:"Oct 18, 2023",sidebarPosition:180,frontMatter:{sidebar_label:"Configuring node persistence",sidebar_position:180,title:"Configuring node persistence",description:"How to configure compute/requester persistence"},sidebar:"documentationSidebar",previous:{title:"GPU Support",permalink:"/running-node/gpu"},next:{title:"Configuring TLS",permalink:"/running-node/configuring-tls"}},s={},u=[{value:"Compute node persistence",id:"compute-node-persistence",level:2},{value:"Requester node persistence",id:"requester-node-persistence",level:2}],d={toc:u},p="wrapper";function c(e){let{components:t,...n}=e;return(0,a.kt)(p,(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Both compute nodes, and requester nodes, maintain state. How that state is maintained is configurable, although the defaults are likely adequate for most use-cases.  This page describes how to configure the persistence of compute and requester nodes should the defaults not be suitable.  "),(0,a.kt)("h2",{id:"compute-node-persistence"},"Compute node persistence"),(0,a.kt)("p",null,"The computes nodes maintain information about the work that has been allocated to them, including:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The current state of the execution, and"),(0,a.kt)("li",{parentName:"ul"},"The original job that resulted in this allocation ")),(0,a.kt)("p",null,'This information is used by the compute and requester nodes to ensure allocated jobs are completed successfully.  By default, compute nodes store their state in a bolt-db database and this is located in the bacalhau repository along with configuration data.  For a compute node whose ID is "abc", the database can be found in ',(0,a.kt)("inlineCode",{parentName:"p"},"~/.bacalhau/abc-compute/executions.db"),"."),(0,a.kt)("p",null,"In some cases, it may be preferable to maintain the state in memory, with the caveat that should the node restart, all state will be lost.  This can be configured using the environment variables in the table below."),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Environment Variable"),(0,a.kt)("th",{parentName:"tr",align:null},"Flag alternative"),(0,a.kt)("th",{parentName:"tr",align:null},"Value"),(0,a.kt)("th",{parentName:"tr",align:null},"Effect"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"BACALHAU_COMPUTE_STORE_TYPE"),(0,a.kt)("td",{parentName:"tr",align:null},"--compute-execution-store-type"),(0,a.kt)("td",{parentName:"tr",align:null},"boltdb"),(0,a.kt)("td",{parentName:"tr",align:null},"Uses the bolt db execution store (default)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"BACALHAU_COMPUTE_STORE_PATH"),(0,a.kt)("td",{parentName:"tr",align:null},"--compute-execution-store-path"),(0,a.kt)("td",{parentName:"tr",align:null},"A path (inc. filename)"),(0,a.kt)("td",{parentName:"tr",align:null},"Specifies where the boltdb database should be stored. Default is ",(0,a.kt)("inlineCode",{parentName:"td"},"~/.bacalhau/{NODE-ID}-compute/executions.db")," if not set")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"BACALHAU_COMPUTE_STORE_TYPE"),(0,a.kt)("td",{parentName:"tr",align:null},"--compute-execution-store-type"),(0,a.kt)("td",{parentName:"tr",align:null},"inmemory"),(0,a.kt)("td",{parentName:"tr",align:null},"Uses the inmemory execution store")))),(0,a.kt)("h2",{id:"requester-node-persistence"},"Requester node persistence"),(0,a.kt)("p",null,'When running a requester node, it maintains state about the jobs it has been requested to orchestrate and schedule, the evaluation of those jobs, and the executions that have been allocated.  By default, this state is stored in a bolt db database that, with a node ID of "xyz" can be found in  ',(0,a.kt)("inlineCode",{parentName:"p"},"~/.bacalhau/xyz-requester/jobs.db"),"."),(0,a.kt)("p",null,"It is possible, but not recommended, to run the requester node with an inmemory job store, which will result in lost state when the requester node is restarted.  "),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Environment Variable"),(0,a.kt)("th",{parentName:"tr",align:null},"Flag alternative"),(0,a.kt)("th",{parentName:"tr",align:null},"Value"),(0,a.kt)("th",{parentName:"tr",align:null},"Effect"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"BACALHAU_JOB_STORE_TYPE"),(0,a.kt)("td",{parentName:"tr",align:null},"--requester-job-store-type"),(0,a.kt)("td",{parentName:"tr",align:null},"boltdb"),(0,a.kt)("td",{parentName:"tr",align:null},"Uses the bolt db job store (default)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"BACALHAU_JOB_STORE_PATH"),(0,a.kt)("td",{parentName:"tr",align:null},"--requester-job-store-path"),(0,a.kt)("td",{parentName:"tr",align:null},"A path (inc. filename)"),(0,a.kt)("td",{parentName:"tr",align:null},"Specifies where the boltdb database should be stored. Default is ",(0,a.kt)("inlineCode",{parentName:"td"},"~/.bacalhau/{NODE-ID}-requester/jobs.db")," if not set")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"BACALHAU_JOB_STORE_TYPE"),(0,a.kt)("td",{parentName:"tr",align:null},"--requester-job-store-type"),(0,a.kt)("td",{parentName:"tr",align:null},"inmemory"),(0,a.kt)("td",{parentName:"tr",align:null},"Uses the inmemory job store")))))}c.isMDXComponent=!0}}]);