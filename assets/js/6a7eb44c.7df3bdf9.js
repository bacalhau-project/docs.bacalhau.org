"use strict";(self.webpackChunkbacalhau_docs=self.webpackChunkbacalhau_docs||[]).push([[3645],{1603:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>l,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var r=t(5893),i=t(1151);const o={sidebar_label:"Networking",sidebar_position:120},a="Networking",s={id:"running-node/networking",title:"Networking",description:"Bacalhau uses libp2p under the hood to communicate with other nodes on the network.",source:"@site/docs/running-node/networking.md",sourceDirName:"running-node",slug:"/running-node/networking",permalink:"/running-node/networking",draft:!1,unlisted:!1,editUrl:"https://github.com/bacalhau-project/docs.bacalhau.org/blob/main/docs/running-node/networking.md",tags:[],version:"current",lastUpdatedAt:1702058642,formattedLastUpdatedAt:"Dec 8, 2023",sidebarPosition:120,frontMatter:{sidebar_label:"Networking",sidebar_position:120},sidebar:"documentationSidebar",previous:{title:"Quick Start Using Docker",permalink:"/running-node/quick-start-docker"},next:{title:"Storage Providers",permalink:"/running-node/storage-providers"}},c={},d=[{value:"Peer identity",id:"peer-identity",level:2},{value:"Configure peers",id:"configure-peers",level:2},{value:"libp2p swarm port",id:"libp2p-swarm-port",level:2},{value:"REST API port",id:"rest-api-port",level:2},{value:"Generic Endpoint",id:"generic-endpoint",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"networking",children:"Networking"}),"\n",(0,r.jsxs)(n.p,{children:["Bacalhau uses ",(0,r.jsx)(n.a,{href:"https://libp2p.io/",children:"libp2p"})," under the hood to communicate with other nodes on the network."]}),"\n",(0,r.jsx)(n.h2,{id:"peer-identity",children:"Peer identity"}),"\n",(0,r.jsx)(n.p,{children:"Because bacalhau is built using libp2p, the concept of peer identity is used to identify nodes on the network."}),"\n",(0,r.jsxs)(n.p,{children:["When you start a bacalhau node using ",(0,r.jsx)(n.code,{children:"bacalhau serve"}),", it will look for an RSA private key in the ",(0,r.jsx)(n.code,{children:"~/.bacalhau"})," directory. If it doesn't find one, it will generate a new one and save it there."]}),"\n",(0,r.jsxs)(n.p,{children:["You can override the directory where the private key is stored using the ",(0,r.jsx)(n.code,{children:"BACALHAU_PATH"})," environment variable."]}),"\n",(0,r.jsxs)(n.p,{children:["Private keys are named after the port used for the libp2p connection which defaults to ",(0,r.jsx)(n.code,{children:"1235"}),". By default when first starting a node, the private key will be stored in ",(0,r.jsx)(n.code,{children:"~/.bacalhau/private_key.1235"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["The peer identity is derived from the private key and is used to identify the node on the network. You can get the peer identity of a node by running ",(0,r.jsx)(n.code,{children:"bacalhau id"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"bacalhau id\n"})}),"\n",(0,r.jsx)(n.h2,{id:"configure-peers",children:"Configure peers"}),"\n",(0,r.jsxs)(n.p,{children:["By default, running ",(0,r.jsx)(n.code,{children:"bacalhau serve"})," will connect to the following nodes (which are the default bootstrap nodes run by Protocol labs):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"/ip4/35.245.115.191/tcp/1235/p2p/QmdZQ7ZbhnvWY1J12XYKGHApJ6aufKyLNSvf8jZBrBaAVL\n/ip4/35.245.61.251/tcp/1235/p2p/QmXaXu9N5GNetatsvwnTfQqNtSeKAD6uCmarbh3LMRYAcF\n/ip4/35.245.251.239/tcp/1235/p2p/QmYgxZiySj3MRkwLSL4X2MF5F9f2PMhAE3LV49XkfNL1o3\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Bacalhau uses libp2p ",(0,r.jsx)(n.a,{href:"https://docs.libp2p.io/concepts/addressing/",children:"multiaddresses"})," to identify nodes on the network."]}),"\n",(0,r.jsxs)(n.p,{children:["If you want to connect to other nodes, and you know their Peer IDs you can use the ",(0,r.jsx)(n.code,{children:"--peer"})," flag to specify additional peers to connect to (comma-separated list)."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"bacalhau serve \\\n  --peer /ip4/35.245.115.191/tcp/1235/p2p/QmdZQ7ZbhnvWY1J12XYKGHApJ6aufKyLNSvf8jZBrBaAVL,/ip4/35.245.61.251/tcp/1235/p2p/QmXaXu9N5GNetatsvwnTfQqNtSeKAD6uCmarbh3LMRYAcF\n"})}),"\n",(0,r.jsx)(n.p,{children:"If you want to connect to a requester node, and you know it's IP but not it's Peer ID, you can use the following which will contact the requester API directly and ask for the current Peer ID instead."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"bacalhau serve \\\n  --peer /ip4/35.245.115.191/tcp/1234/http\n"})}),"\n",(0,r.jsx)(n.h2,{id:"libp2p-swarm-port",children:"libp2p swarm port"}),"\n",(0,r.jsxs)(n.p,{children:["The default port the libp2p swarm listens on is ",(0,r.jsx)(n.strong,{children:"1235"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["You can configure the swarm port using the ",(0,r.jsx)(n.code,{children:"--port"})," flag:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"bacalhau serve \\\n  --port 1235\n"})}),"\n",(0,r.jsx)(n.p,{children:"To ensure that the node can communicate with other nodes on the network, make sure the swarm port is open and accessible by other nodes."}),"\n",(0,r.jsx)(n.h2,{id:"rest-api-port",children:"REST API port"}),"\n",(0,r.jsx)(n.p,{children:"The Bacalhau node exposes a REST API that can be used to query the node for information."}),"\n",(0,r.jsxs)(n.p,{children:["The default port the REST API listens on is ",(0,r.jsx)(n.strong,{children:"1234"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["The default network interface the REST API listens on is ",(0,r.jsx)(n.strong,{children:"0.0.0.0"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["You can configure the REST API port using the ",(0,r.jsx)(n.code,{children:"--api-port"})," flag:"]}),"\n",(0,r.jsxs)(n.p,{children:["You can also configure which network interface the REST API will bind to using the ",(0,r.jsx)(n.code,{children:"--host"})," flag:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"bacalhau serve \\\n  --api-port 1234 \\\n  --host 127.0.0.1\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["You can use the ",(0,r.jsx)(n.code,{children:"--host"})," flag to restrict network access to the REST API."]})}),"\n",(0,r.jsx)(n.h2,{id:"generic-endpoint",children:"Generic Endpoint"}),"\n",(0,r.jsxs)(n.p,{children:["You can call ",(0,r.jsx)(n.a,{href:"http://dashboard.bacalhau.org:1000/api/v1/run",children:"http://dashboard.bacalhau.org:1000/api/v1/run"})," with the POST body as a JSON serialized spec"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -XPOST -d \'{"Engine": "Docker", "Docker": {"Image": "ubuntu", "Entrypoint": ["echo"], "Parameters": ["hello"]}, "Deal": {"Concurrency": 1}, "Verifier": "Noop", "PublisherSpec":{"Type":"IPFS"}}\' \'http://dashboard.bacalhau.org:1000/api/v1/run\';\n'})}),"\n",(0,r.jsx)(n.p,{children:"Once you run the command above, you'll get a CID output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'"cid": "QmeNhAA97qtdGHQtd1Qvgk13C6GHkn6aTCT8ih53JLN7vL"\n'})})]})}function l(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>s,a:()=>a});var r=t(7294);const i={},o=r.createContext(i);function a(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);