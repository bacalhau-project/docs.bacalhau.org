"use strict";(self.webpackChunkbacalhau_docs=self.webpackChunkbacalhau_docs||[]).push([[5888],{3403:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var o=i(5893),r=i(1151);const a={sidebar_label:"Configuration",sidebar_position:160,description:"How to configure your Bacalhau node."},t="Configuration Overview",s={id:"running-node/configuration",title:"Configuration Overview",description:"How to configure your Bacalhau node.",source:"@site/docs/running-node/configuration.md",sourceDirName:"running-node",slug:"/running-node/configuration",permalink:"/running-node/configuration",draft:!1,unlisted:!1,editUrl:"https://github.com/bacalhau-project/docs.bacalhau.org/blob/main/docs/running-node/configuration.md",tags:[],version:"current",lastUpdatedAt:1701669642,formattedLastUpdatedAt:"Dec 4, 2023",sidebarPosition:160,frontMatter:{sidebar_label:"Configuration",sidebar_position:160,description:"How to configure your Bacalhau node."},sidebar:"documentationSidebar",previous:{title:"Observability",permalink:"/running-node/observability"},next:{title:"References",permalink:"/references"}},l={},c=[{value:"The Bacalhau Repo",id:"the-bacalhau-repo",level:2},{value:"Below is the structure of a freshly initialized <code>.bacalhau</code> repository:",id:"below-is-the-structure-of-a-freshly-initialized-bacalhau-repository",level:3},{value:"Files",id:"files",level:4},{value:"Directories",id:"directories",level:4},{value:"Configuring a Bacalhau Node",id:"configuring-a-bacalhau-node",level:2},{value:"Relationship Between <code>config.yaml</code> and Bacalhau Environment Variables",id:"relationship-between-configyaml-and-bacalhau-environment-variables",level:3},{value:"Environments",id:"environments",level:3},{value:"1. Production (public network)",id:"1-production-public-network",level:4},{value:"2. Staging (staging network)",id:"2-staging-staging-network",level:4},{value:"3. Development (development network)",id:"3-development-development-network",level:4},{value:"4. Local (private or local networks)",id:"4-local-private-or-local-networks",level:4},{value:"Usage Examples",id:"usage-examples",level:2},{value:"How to initialize a Bacalhau Server for a local private network",id:"how-to-initialize-a-bacalhau-server-for-a-local-private-network",level:3},{value:"How to initialize a Bacalhau Server with a custom repo path",id:"how-to-initialize-a-bacalhau-server-with-a-custom-repo-path",level:3},{value:"How to start a Bacalhau Server with DEBUG logs",id:"how-to-start-a-bacalhau-server-with-debug-logs",level:3}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"configuration-overview",children:"Configuration Overview"}),"\n",(0,o.jsxs)(n.p,{children:["Bacalhau employs the ",(0,o.jsx)(n.a,{href:"https://github.com/spf13/viper",children:"viper"})," and ",(0,o.jsx)(n.a,{href:"https://github.com/spf13/cobra",children:"cobra"})," libraries for configuration management. Users can configure their Bacalhau node through a combination of command-line flags, environment variables, and the dedicated configuration file."]}),"\n",(0,o.jsx)(n.h2,{id:"the-bacalhau-repo",children:"The Bacalhau Repo"}),"\n",(0,o.jsxs)(n.p,{children:["Bacalhau manages its configuration, metadata, and internal state within a specialized repository named ",(0,o.jsx)(n.code,{children:".bacalhau"}),". Serving as the heart of the Bacalhau node, this repository holds the  data and settings that determine node behavior. It's located on the  filesystem, and by default, Bacalhau initializes this repository at ",(0,o.jsx)(n.code,{children:"$HOME/.bacalhau"}),", where ",(0,o.jsx)(n.code,{children:"$HOME"})," is the home directory of the user running the bacalhau process."]}),"\n",(0,o.jsx)(n.p,{children:"To customize this location, users can:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Set the ",(0,o.jsx)(n.code,{children:"BACALHAU_DIR"})," environment variable to specify their desired path."]}),"\n",(0,o.jsxs)(n.li,{children:["Utilize the ",(0,o.jsx)(n.code,{children:"--repo"})," command line flag to specify their desired path."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Upon executing a Bacalhau command for the first time, the system will initialize the ",(0,o.jsx)(n.code,{children:".bacalhau"})," repository. If such a repository already exists, Bacalhau will seamlessly access its contents."]}),"\n",(0,o.jsxs)(n.p,{children:["Structure of a Newly Initialized ",(0,o.jsx)(n.code,{children:".bacalhau"})," Repository"]}),"\n",(0,o.jsxs)(n.h3,{id:"below-is-the-structure-of-a-freshly-initialized-bacalhau-repository",children:["Below is the structure of a freshly initialized ",(0,o.jsx)(n.code,{children:".bacalhau"})," repository:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"$ tree ~/.bacalhau\n\u251c\u2500\u2500 QmdGUjsMHEgtAfdtw7U62yPEcAZFtA33tKMsczLToegZtv-compute/\n\u2502   \u251c\u2500\u2500 executions.db\n\u2502   \u2514\u2500\u2500 jobStats.json\n\u251c\u2500\u2500 QmdGUjsMHEgtAfdtw7U62yPEcAZFtA33tKMsczLToegZtv-requester/\n\u2502   \u2514\u2500\u2500 jobs.db\n\u251c\u2500\u2500 config.yaml\n\u251c\u2500\u2500 executor_storages/\n\u251c\u2500\u2500 libp2p_private_key\n\u251c\u2500\u2500 plugins/\n\u251c\u2500\u2500 repo.version\n\u2514\u2500\u2500 user_id.pem\n"})}),"\n",(0,o.jsx)(n.p,{children:"This repository comprises four directories and seven files:"}),"\n",(0,o.jsx)(n.h4,{id:"files",children:"Files"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"user_id.pem"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"This file houses the Bacalhau node user's cryptographic private key, used for signing requests sent to a Requester Node."}),"\n",(0,o.jsx)(n.li,{children:"Format: PEM."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"repo.version"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Indicates the version of the Bacalhau node's repository."}),"\n",(0,o.jsxs)(n.li,{children:["Format: JSON, e.g., ",(0,o.jsx)(n.code,{children:'{"Version":1}'}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"libp2p_private_key"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Stores the Bacalhau node's ",(0,o.jsx)(n.a,{href:"https://libp2p.io/",children:"libp2p"})," private key, essential for its network identity. The NodeID of a Bacalhau node is derived from this key."]}),"\n",(0,o.jsx)(n.li,{children:"Format: Base64 encoded RSA private key."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"config.yaml"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Contains configuration settings for the Bacalhau node."}),"\n",(0,o.jsx)(n.li,{children:"Format: YAML."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"directories",children:"Directories"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"QmdGUjsMHEgtAfdtw7U62yPEcAZFtA33tKMsczLToegZtv-compute"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Contains the ",(0,o.jsx)(n.a,{href:"https://github.com/etcd-io/bbolt",children:"BoltDB"})," ",(0,o.jsx)(n.code,{children:"executions.db"})," database, which aids the Compute node in state persistence. Additionally, the ",(0,o.jsx)(n.code,{children:"jobStats.json"})," file records the Compute Node's completed jobs tally."]}),"\n",(0,o.jsxs)(n.li,{children:["Note: The segment ",(0,o.jsx)(n.code,{children:"QmdGUjsMHEgtAfdtw7U62yPEcAZFtA33tKMsczLToegZtv"})," is a unique NodeID for each Bacalhau node, derived from the ",(0,o.jsx)(n.code,{children:"libp2p_private_key"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"QmdGUjsMHEgtAfdtw7U62yPEcAZFtA33tKMsczLToegZtv-requester"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Contains the ",(0,o.jsx)(n.a,{href:"https://github.com/etcd-io/bbolt",children:"BoltDB"})," ",(0,o.jsx)(n.code,{children:"jobs.db"})," database for the Requester node's state persistence."]}),"\n",(0,o.jsx)(n.li,{children:"Note: NodeID derivation is similar to the Compute directory."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"executor_storages"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Storage for data handled by Bacalhau storage drivers."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"plugins"}),":","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Houses binaries that allow the Compute node to execute specific tasks."}),"\n",(0,o.jsx)(n.li,{children:"Note: This feature is currently experimental and isn't active during standard node operations."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"configuring-a-bacalhau-node",children:"Configuring a Bacalhau Node"}),"\n",(0,o.jsxs)(n.p,{children:["Within a ",(0,o.jsx)(n.code,{children:".bacalhau"})," repository, a ",(0,o.jsx)(n.code,{children:"config.yaml"})," file may be present. This file serves as the configuration source for the bacalhau node and adheres to the YAML format."]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Note:"})," On the initialization of a new ",(0,o.jsx)(n.code,{children:".bacalhau"})," repository, Bacalhau will generate a ",(0,o.jsx)(n.code,{children:"config.yaml"})," file. However, if Bacalhau is opening an existing repository, it will not create this file if it's absent."]}),"\n",(0,o.jsxs)(n.p,{children:["Although the ",(0,o.jsx)(n.code,{children:"config.yaml"})," file is optional, its presence allows Bacalhau to load custom configurations; otherwise, Bacalhau is configured with built-in default values, environment variables and command line flags."]}),"\n",(0,o.jsxs)(n.p,{children:["Modifications to the ",(0,o.jsx)(n.code,{children:"config.yaml"})," file will not be dynamically loaded by the Bacalhau node. A restart of the node is required for any changes to take effect. Bacalhau determines its configuration based on the following precedence order, with each item superseding the subsequent:"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Command-line Flag"}),"\n",(0,o.jsx)(n.li,{children:"Environment Variable"}),"\n",(0,o.jsx)(n.li,{children:"Config File"}),"\n",(0,o.jsx)(n.li,{children:"Defaults"}),"\n"]}),"\n",(0,o.jsxs)(n.h3,{id:"relationship-between-configyaml-and-bacalhau-environment-variables",children:["Relationship Between ",(0,o.jsx)(n.code,{children:"config.yaml"})," and Bacalhau Environment Variables"]}),"\n",(0,o.jsxs)(n.p,{children:["Bacalhau establishes a direct relationship between the value-bearing keys within the ",(0,o.jsx)(n.code,{children:"config.yaml"})," file and corresponding environment variables. For these keys that have no further sub-keys, the environment variable name is constructed by capitalizing each segment of the key, and then joining them with underscores, prefixed with ",(0,o.jsx)(n.code,{children:"BACALHAU_"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["For example, a YAML key with the path ",(0,o.jsx)(n.code,{children:"Node.IPFS.Connect"})," translates to the environment variable ",(0,o.jsx)(n.code,{children:"BACALHAU_NODE_IPFS_CONNECT"})," and is represented in a file like:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"Node:\n    IPFS:\n        Connect: value\n"})}),"\n",(0,o.jsxs)(n.p,{children:["There is no corresponding environment variable for either ",(0,o.jsx)(n.code,{children:"Node"})," or ",(0,o.jsx)(n.code,{children:"Node.IPFS"}),".\nConfig values may also have other environment variables that set them for\nsimplicity or to maintain backwards compatibility."]}),"\n",(0,o.jsx)(n.h3,{id:"environments",children:"Environments"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Bacalhau leverages the ",(0,o.jsx)(n.code,{children:"BACALHAU_ENVIRONMENT"})," environment variable to determine the specific environment configuration when initializing a repository. Notably, if a ",(0,o.jsx)(n.code,{children:".bacalhau"})," repository has already been initialized, the ",(0,o.jsx)(n.code,{children:"BACALHAU_ENVIRONMENT"})," setting will be ignored."]}),"\n",(0,o.jsxs)(n.p,{children:["By default, if the ",(0,o.jsx)(n.code,{children:"BACALHAU_ENVIRONMENT"})," variable is not explicitly set by the user, Bacalhau will adopt the ",(0,o.jsx)(n.code,{children:"production"})," environment settings."]}),"\n",(0,o.jsx)(n.p,{children:"Below is a breakdown of the configurations associated with each environment:"}),"\n",(0,o.jsx)(n.h4,{id:"1-production-public-network",children:"1. Production (public network)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Environment Variable:"})," ",(0,o.jsx)(n.code,{children:"BACALHAU_ENVIRONMENT=production"})]}),"\n",(0,o.jsxs)(n.li,{children:["Configurations:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Node.ClientAPI.Host"}),": ",(0,o.jsx)(n.code,{children:'"bootstrap.production.bacalhau.org"'})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Node.Client.API.Host"}),": ",(0,o.jsx)(n.code,{children:"1234"})]}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.em,{children:"...other configurations specific to this environment..."})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"2-staging-staging-network",children:"2. Staging (staging network)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Environment Variable:"})," ",(0,o.jsx)(n.code,{children:"BACALHAU_ENVIRONMENT=staging"})]}),"\n",(0,o.jsxs)(n.li,{children:["Configurations:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Node.ClientAPI.Host"}),": ",(0,o.jsx)(n.code,{children:'"bootstrap.staging.bacalhau.org"'})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Node.Client.API.Host"}),": ",(0,o.jsx)(n.code,{children:"1234"})]}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.em,{children:"...other configurations specific to this environment..."})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"3-development-development-network",children:"3. Development (development network)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Environment Variable:"})," ",(0,o.jsx)(n.code,{children:"BACALHAU_ENVIRONMENT=development"})]}),"\n",(0,o.jsxs)(n.li,{children:["Configurations:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Node.ClientAPI.Host"}),": ",(0,o.jsx)(n.code,{children:'"bootstrap.development.bacalhau.org"'})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Node.Client.API.Host"}),": ",(0,o.jsx)(n.code,{children:"1234"})]}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.em,{children:"...other configurations specific to this environment..."})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"4-local-private-or-local-networks",children:"4. Local (private or local networks)"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Environment Variable:"})," ",(0,o.jsx)(n.code,{children:"BACALHAU_ENVIRONMENT=local"})]}),"\n",(0,o.jsxs)(n.li,{children:["Configurations:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Node.ClientAPI.Host"}),": ",(0,o.jsx)(n.code,{children:'"0.0.0.0"'})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Node.Client.API.Host"}),": ",(0,o.jsx)(n.code,{children:"1234"})]}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.em,{children:"...other configurations specific to this environment..."})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Note"}),": The above configurations provided for each environment are not exhaustive. Consult the specific environment documentation for a ",(0,o.jsx)(n.a,{href:"https://github.com/bacalhau-project/bacalhau/tree/main/pkg/config/configenv",children:"comprehensive list of configurations"}),"."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,o.jsx)(n.h3,{id:"how-to-initialize-a-bacalhau-server-for-a-local-private-network",children:"How to initialize a Bacalhau Server for a local private network"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"$ env BACALHAU_ENVIRONMENT=local ./bin/darwin_arm64/bacalhau serve\nINF pkg/repo/fs.go:187 > Initializing repo at '/Users/frrist/.bacalhau' for environment 'local'\n"})}),"\n",(0,o.jsx)(n.h3,{id:"how-to-initialize-a-bacalhau-server-with-a-custom-repo-path",children:"How to initialize a Bacalhau Server with a custom repo path"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"$ bacalhau --repo=/path/to/repo serve\nINF pkg/repo/fs.go:187 > Initializing repo at '/path/to/repo' for environment 'production'\n"})}),"\n",(0,o.jsx)(n.p,{children:"Or"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"$ export BACALHAU_DIR=/path/to/repo\n$ bacalhau serve\nINF pkg/repo/fs.go:187 > Initializing repo at '/path/to/repo' for environment 'production'\n"})}),"\n",(0,o.jsx)(n.h3,{id:"how-to-start-a-bacalhau-server-with-debug-logs",children:"How to start a Bacalhau Server with DEBUG logs"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"$ env LOG_LEVEL=debug ./bin/darwin_arm64/bacalhau serve\nDBG pkg/system/environment.go:53 > Defaulting to production environment: os.Args: [./bin/darwin_arm64/bacalhau serve]\n\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},1151:(e,n,i)=>{i.d(n,{Z:()=>s,a:()=>t});var o=i(7294);const r={},a=o.createContext(r);function t(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);