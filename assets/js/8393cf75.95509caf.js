"use strict";(self.webpackChunkbacalhau_docs=self.webpackChunkbacalhau_docs||[]).push([[3391],{8770:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>i,contentTitle:()=>c,default:()=>d,frontMatter:()=>s,metadata:()=>r,toc:()=>l});var t=n(5893),o=n(1151);const s={sidebar_label:"Bacalhau Docker Image",sidebar_position:1,description:"How to use the Bacalhau Docker image"},c="Bacalhau Docker Image",r={id:"examples/workload-onboarding/bacalhau-docker-image/index",title:"Bacalhau Docker Image",description:"How to use the Bacalhau Docker image",source:"@site/docs/examples/workload-onboarding/bacalhau-docker-image/index.md",sourceDirName:"examples/workload-onboarding/bacalhau-docker-image",slug:"/examples/workload-onboarding/bacalhau-docker-image/",permalink:"/examples/workload-onboarding/bacalhau-docker-image/",draft:!1,unlisted:!1,editUrl:"https://github.com/bacalhau-project/docs.bacalhau.org/blob/main/docs/examples/workload-onboarding/bacalhau-docker-image/index.md",tags:[],version:"current",lastUpdatedAt:1702309452,formattedLastUpdatedAt:"Dec 11, 2023",sidebarPosition:1,frontMatter:{sidebar_label:"Bacalhau Docker Image",sidebar_position:1,description:"How to use the Bacalhau Docker image"},sidebar:"documentationSidebar",previous:{title:"Workload Onboarding",permalink:"/category/workload-onboarding"},next:{title:"Reading-From-Multiple-S3-Buckets",permalink:"/examples/workload-onboarding/Reading-From-Multiple-S3-Buckets/"}},i={},l=[{value:"TD;LR",id:"tdlr",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Pull the Docker image",id:"pull-the-docker-image",level:2},{value:"Check version",id:"check-version",level:2},{value:"Running a Bacalhau Job",id:"running-a-bacalhau-job",level:2},{value:"Structure of the command",id:"structure-of-the-command",level:3},{value:"Submit a Job With Output Files",id:"submit-a-job-with-output-files",level:2},{value:"Checking the State of your Jobs",id:"checking-the-state-of-your-jobs",level:2},{value:"Need Support?",id:"need-support",level:2}];function h(e){const a={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.h1,{id:"bacalhau-docker-image",children:"Bacalhau Docker Image"}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.a,{href:"https://github.com/bacalhau-project/bacalhau",children:(0,t.jsx)(a.img,{src:"https://img.shields.io/github/stars/bacalhau-project/bacalhau?style=social",alt:"stars - badge-generator"})})}),"\n",(0,t.jsx)(a.p,{children:"This example shows you how to run some common client-side Bacalhau tasks using the Bacalhau Docker image."}),"\n",(0,t.jsx)(a.h2,{id:"tdlr",children:"TD;LR"}),"\n",(0,t.jsx)(a.p,{children:"Running Docker image on Bacalhau"}),"\n",(0,t.jsx)(a.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(a.p,{children:["To get started, you need to install the Bacalhau client, see more information ",(0,t.jsx)(a.a,{href:"https://docs.bacalhau.org/getting-started/installation",children:"here"})]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-python",children:"!command -v bacalhau >/dev/null 2>&1 || (export BACALHAU_INSTALL_DIR=.; curl -sL https://get.bacalhau.org/install.sh | bash)\npath=!echo $PATH\n%env PATH=./:{path[0]}\n"})}),"\n",(0,t.jsx)(a.h2,{id:"pull-the-docker-image",children:"Pull the Docker image"}),"\n",(0,t.jsxs)(a.p,{children:["The first step is to pull the Bacalhau Docker image from the ",(0,t.jsx)(a.a,{href:"https://github.com/orgs/bacalhau-project/packages/container/package/bacalhau",children:"Github container registry"}),"."]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"%%bash\ndocker pull ghcr.io/bacalhau-project/bacalhau:latest\n"})}),"\n",(0,t.jsxs)(a.p,{children:["latest: Pulling from bacalhau-project/bacalhau\nDigest: sha256",":d80f1fe751886a29e0d5ae265a88abbfcd5c59e36247473b66aba93ea24f45aa","\nStatus: Image is up to date for ghcr.io/bacalhau-project/bacalhau",":latest","\nghcr.io/bacalhau-project/bacalhau",":latest"]}),"\n",(0,t.jsx)(a.p,{children:"You can also pull a specific version of the image, e.g.:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"docker pull ghcr.io/bacalhau-project/bacalhau:v0.3.16\n"})}),"\n",(0,t.jsx)(a.admonition,{type:"warning",children:(0,t.jsxs)(a.p,{children:['Remember that the "latest" tag is just a string. It doesn\'t refer to the latest version of the Bacalhau client, it refers to an image that has the "latest" tag. Therefore, if your machine has already downloaded the "latest" image, it won\'t download it again. To force a download, you can use the ',(0,t.jsx)(a.code,{children:"--no-cache"})," flag."]})}),"\n",(0,t.jsx)(a.h2,{id:"check-version",children:"Check version"}),"\n",(0,t.jsx)(a.p,{children:"Check the version of the Bacalhau client you are using."}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"%%bash\ndocker run -t ghcr.io/bacalhau-project/bacalhau:latest version\n"})}),"\n",(0,t.jsx)(a.p,{children:"Client Version: v0.3.29\nServer Version: v0.3.29"}),"\n",(0,t.jsx)(a.h2,{id:"running-a-bacalhau-job",children:"Running a Bacalhau Job"}),"\n",(0,t.jsxs)(a.p,{children:["To submit a bi to Bacalhau, we use the ",(0,t.jsx)(a.code,{children:"bacalhau docker run"})," command."]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"%%bash --out job_id\ndocker run -t ghcr.io/bacalhau-project/bacalhau:latest \\\n    docker run \\\n        --id-only \\\n        --wait \\\n        ubuntu:latest -- \\\n            sh -c 'uname -a && echo \"Hello from Docker Bacalhau!\"'\n"})}),"\n",(0,t.jsx)(a.p,{children:"In this example, I run an Ubuntu-based job that echo's some stuff."}),"\n",(0,t.jsx)(a.h3,{id:"structure-of-the-command",children:"Structure of the command"}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsxs)(a.li,{children:["\n",(0,t.jsxs)(a.p,{children:[(0,t.jsx)(a.code,{children:"--id-only......"}),": Output only the job id"]}),"\n"]}),"\n",(0,t.jsxs)(a.li,{children:["\n",(0,t.jsxs)(a.p,{children:[(0,t.jsx)(a.code,{children:"ubuntu:latest."})," Ubuntu container"]}),"\n"]}),"\n",(0,t.jsxs)(a.li,{children:["\n",(0,t.jsxs)(a.p,{children:[(0,t.jsx)(a.code,{children:"ghcr.io/bacalhau-project/bacalhau:latest "}),": Name of the Bacalhau Docker image"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(a.p,{children:["When a job is submitted, Bacalhau prints out the related ",(0,t.jsx)(a.code,{children:"job_id"}),". We store that in an environment variable so that we can reuse it later on."]}),"\n",(0,t.jsx)(a.p,{children:"env: JOB_ID=738e0b39-8f73-4f01-ab46-245e8479ad65"}),"\n",(0,t.jsx)(a.p,{children:"To print out the content of the Job ID, run the following command:"}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:'%%bash\ndocker run -t ghcr.io/bacalhau-project/bacalhau:latest \\\n    describe $JOB_ID \\\n        | grep -A 2 "stdout: |"\n'})}),"\n",(0,t.jsx)(a.p,{children:"stdout: |\nLinux 914f42609298 5.19.0-1022-gcp #24~22.04.1-Ubuntu SMP Sun Apr 23 09:51:08 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux\nHello from Docker Bacalhau!"}),"\n",(0,t.jsx)(a.h2,{id:"submit-a-job-with-output-files",children:"Submit a Job With Output Files"}),"\n",(0,t.jsx)(a.p,{children:"One inconvenience that you'll see is that you'll need to mount directories into the container to access files. This is because the container is running in a separate environment from your host machine. Let's take a look at the example below:"}),"\n",(0,t.jsx)(a.p,{children:"The first part of the example should look familiar, except for the Docker commands."}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:'%%bash --out job_id\ndocker run -t ghcr.io/bacalhau-project/bacalhau:latest \\\n    docker run \\\n        --id-only \\\n        --wait \\\n        --gpu 1 \\\n        ghcr.io/bacalhau-project/examples/stable-diffusion-gpu:0.0.1 -- \\\n            python main.py --o ./outputs --p "A Docker whale and a cod having a conversation about the state of the ocean"\n'})}),"\n",(0,t.jsxs)(a.p,{children:["When a job is submitted, Bacalhau prints out the related ",(0,t.jsx)(a.code,{children:"job_id"}),". We store that in an environment variable so that we can reuse it later on."]}),"\n",(0,t.jsx)(a.p,{children:"env: JOB_ID=bd141e1a-0f68-4a20-886f-c2b30c01b614"}),"\n",(0,t.jsx)(a.h2,{id:"checking-the-state-of-your-jobs",children:"Checking the State of your Jobs"}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.strong,{children:"Job status"}),": You can check the status of the job using ",(0,t.jsx)(a.code,{children:"bacalhau list"}),"."]}),"\n"]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"%%bash\ndocker run -t ghcr.io/bacalhau-project/bacalhau:latest \\\n    list $JOB_ID \\\n"})}),"\n",(0,t.jsxs)(a.p,{children:["When it says ",(0,t.jsx)(a.code,{children:"Completed"}),", that means the job is done, and we can get the results."]}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.strong,{children:"Job information"}),": You can find out more information about your job by using ",(0,t.jsx)(a.code,{children:"bacalhau describe"}),"."]}),"\n"]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"%%bash\ndocker run -t ghcr.io/bacalhau-project/bacalhau:latest \\\n    describe $JOB_ID \\\n\n"})}),"\n",(0,t.jsxs)(a.ul,{children:["\n",(0,t.jsxs)(a.li,{children:[(0,t.jsx)(a.strong,{children:"Job download"}),": You can download your job results directly by using ",(0,t.jsx)(a.code,{children:"bacalhau get"}),". Alternatively, you can choose to create a directory to store your results. In the command below, we created a directory and downloaded our job output to be stored in that directory."]}),"\n"]}),"\n",(0,t.jsx)(a.pre,{children:(0,t.jsx)(a.code,{className:"language-bash",children:"%%bash\nbacalhau get ${JOB_ID} --output-dir result\n"})}),"\n",(0,t.jsx)(a.p,{children:"After the download has finished you should see the following contents in the results directory."}),"\n",(0,t.jsx)(a.p,{children:(0,t.jsx)(a.img,{alt:"png",src:n(1375).Z+"",width:"512",height:"512"})}),"\n",(0,t.jsx)(a.h2,{id:"need-support",children:"Need Support?"}),"\n",(0,t.jsxs)(a.p,{children:["If have questions or need support or guidance, please reach out to the ",(0,t.jsx)(a.a,{href:"https://filecoin.io/slack",children:"Bacalhau team via Slack (#bacalhau channel)"})]})]})}function d(e={}){const{wrapper:a}={...(0,o.a)(),...e.components};return a?(0,t.jsx)(a,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},1375:(e,a,n)=>{n.d(a,{Z:()=>t});const t=n.p+"assets/images/index_25_0-07e2458df29809575f6b44eb5701788a.png"},1151:(e,a,n)=>{n.d(a,{Z:()=>r,a:()=>c});var t=n(7294);const o={},s=t.createContext(o);function c(e){const a=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function r(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),t.createElement(s.Provider,{value:a},e.children)}}}]);