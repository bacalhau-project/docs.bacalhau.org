<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-getting-started/architecture">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Architecture | Bacalhau Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.bacalhau.org/getting-started/architecture"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="Bacalhau Docs contains ifnormation for fast, cost efficient, and secure computation by explaining how to run jobs where the data is generated and stored."><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Architecture | Bacalhau Docs"><meta data-rh="true" name="description" content="image"><meta data-rh="true" property="og:description" content="image"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.bacalhau.org/getting-started/architecture"><link data-rh="true" rel="alternate" href="https://docs.bacalhau.org/getting-started/architecture" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.bacalhau.org/getting-started/architecture" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://VLYBZRSZSU-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D6NP6P151C"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-D6NP6P151C",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Bacalhau Docs" href="/opensearch.xml">
<script src="https://plausible.io/js/plausible.js" async defer="defer" data-domain="docs.bacalhau.org"></script><link rel="stylesheet" href="/assets/css/styles.a194e7d5.css">
<link rel="preload" href="/assets/js/runtime~main.a458cb06.js" as="script">
<link rel="preload" href="/assets/js/main.d662fde7.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Bacalhau Docs Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Bacalhau Docs Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Bacalhau Docs</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/bacalhau-project/bacalhau" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Home</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/getting-started/architecture">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/getting-started/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/docker-workload-onboarding">Onboard Docker Workload</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/wasm-workload-onboarding">Onboard WebAssembly Workload</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/resources">Specifying Hardware Requirements</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/data-ingestion/from-url">Data Ingestion</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/next-steps/gpu">Processes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/running-node/quick-start">Running a Node</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/quick-start-pvt-cluster">Running a Private Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/all-flags">CLI Reference</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/examples/">Examples</a><button aria-label="Toggle the collapsible sidebar category &#x27;Examples&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/sdk/python-sdk">SDK</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/troubleshooting/debugging">Troubleshooting</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/integration/apache-airflow">Integration</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/faqs">FAQs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/advanced-guides/compute-landscape">Advanced Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/community/style-guide">Community</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Getting Started</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Architecture</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Architecture</h1><p><img loading="lazy" alt="image" src="/assets/images/architecture-purpose-f192f229e16abe177d77f146ab2dca30.jpeg" title="Bacalhau Architecture" width="1152" height="864" class="img_ev3q"></p><p>Bacalhau is a peer-to-peer network of nodes that allows for decentralized communication between computers. Each node in the network has two components: a <strong>requestor</strong> component and a <strong>compute</strong> component.</p><p>To interact with the Bacalhau network, users can use the Bacalhau CLI (command-line interface) to send requests to a node in the network. These requests are sent using the JSON format over HTTP, a widely-used protocol for transmitting data over the internet.</p><p>When a request is received by a node in the network, it is broadcasted over the transport layer to all other nodes in the network. The transport layer is responsible for transmitting data between nodes, and because all nodes are connected to it, they all have a shared view of the network.</p><p>This shared view enables efficient and decentralized communication between nodes in the network, as all nodes are immediately made aware of any updates or changes made by other nodes.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="system-components">System Components<a href="#system-components" class="hash-link" aria-label="Direct link to System Components" title="Direct link to System Components">​</a></h2><p>Bacalhau&#x27;s architecture involves to main sections which is the <strong>core components</strong> and <strong>interfaces</strong>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="core-components">Core Components<a href="#core-components" class="hash-link" aria-label="Direct link to Core Components" title="Direct link to Core Components">​</a></h2><p>The core components are responsible for handling requests and connecting different nodes. It consist of:</p><ul><li><a href="#requestor-node">Requester node</a></li><li><a href="#compute-node">Compute node</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="requester-node">Requester node<a href="#requester-node" class="hash-link" aria-label="Direct link to Requester node" title="Direct link to Requester node">​</a></h3><p>In the Bacalhau network, the requestor node is responsible for handling requests from clients using JSON over HTTP. This node serves as the main custodian of jobs that are submitted to it.</p><p>When a job is submitted to a requestor node, it broadcasts the job to the network and accepts or rejects the bids that come back for that job. It is important to note that there is only ever a single requestor node for a given job, which is the node that the job was originally submitted to.</p><p>Once the compute nodes in the network have executed the job, they will produce verification proposals. These proposals will be collated and combined by the requestor node when enough have been proposed. At this point, the proposals will be either accepted or rejected, and the compute nodes will then publish their raw results.</p><p>Overall, the requestor node plays a crucial role in the Bacalhau network, serving as the main point of contact for clients and the primary handler of jobs that are submitted to the network. By effectively managing job requests and verification proposals, the requestor node enables efficient and effective communication between nodes in the network, making it a valuable tool for decentralized computing applications.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="compute-node">Compute node<a href="#compute-node" class="hash-link" aria-label="Direct link to Compute node" title="Direct link to Compute node">​</a></h3><p>In the Bacalhau network, the compute node plays a critical role in the process of executing jobs and producing results. When a new job is detected on the network, the compute node will determine whether it wants to bid on that job or not. If a bid is made and accepted by the requester node, the compute node will run the job using its collection of executors, each of which has its own collection of storage providers.</p><p>Once the executor has run the job and produced results, the compute node will generate a verification proposal. This proposal will be collated by the requester node along with proposals from other compute nodes that ran the same job. These proposals will then be either accepted or rejected, after which the compute node will publish its raw results via the publisher interface. The compute node has a collection of named executors, verifiers, and publishers, and it will choose the most appropriate ones based on the job specifications.</p><p>Overall, the compute node is a crucial component of the Bacalhau network, responsible for executing jobs and producing results. By efficiently managing the bidding and verification process, the Compute node enables effective communication between nodes in the network, making it a valuable tool for decentralized computing applications.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="interface">Interface<a href="#interface" class="hash-link" aria-label="Direct link to Interface" title="Direct link to Interface">​</a></h2><p>The interface handles the distribution, execution, storage, verification and publishing of jobs.</p><ul><li><a href="#transport">Transport</a></li><li><a href="#executor">Executor</a></li><li><a href="#storage-provider">Storage Provider</a></li><li><a href="#verifier">Verifier</a></li><li><a href="#publisher">Publisher</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="transport">Transport<a href="#transport" class="hash-link" aria-label="Direct link to Transport" title="Direct link to Transport">​</a></h3><p>The transport interface is responsible for sending messages about jobs that are created, bid upon, and executed  to other compute nodes. It also manages the identity of individual Bacalhau nodes to ensure that messages are only delivered to authorized nodes, which improves network security.</p><p>To achieve this, the transport interface uses a protocol called <strong>bprotocol</strong>, which is a point-to-point scheduling protocol that runs over <a href="https://libp2p.io/" target="_blank" rel="noopener noreferrer">libp2p</a> and is used to distribute job messages efficiently to other nodes on the network. This is our upgrade to the <a href="https://docs.libp2p.io/concepts/publish-subscribe/" target="_blank" rel="noopener noreferrer">GossipSub</a> handler as it ensures that messages are delivered to the right nodes without causing network congestion, thereby making communication between nodes more scalable and efficient.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="executor">Executor<a href="#executor" class="hash-link" aria-label="Direct link to Executor" title="Direct link to Executor">​</a></h3><p>The executor is a critical component of the Bacalhau network that handles the execution of jobs and ensures that the storage used by the job is local. One of its main responsibilities is to present the input and output storage volumes into the job when it is run.</p><p>It is important to note that storage can differ between Docker and WebAssembly (wasm). Therefore, if a job references a specific CID (Content IDentifier), two different storage providers may be used based on the executor used for the job.</p><p>The executor performs two primary functions: </p><ul><li>presenting the storage volumes in a format that is suitable for the executor, and,</li><li>running the job. </li></ul><p>When the job is completed, the executor will merge the stdout, stderr, and named output volumes into a results folder. This results folder is used to generate a verification proposal that is sent to the requester.</p><p>Once the proposal is accepted or rejected, the results folder is then forwarded to the publisher for publication. Overall, the executor plays a crucial role in the Bacalhau network by ensuring that jobs are executed properly, and their results are published accurately.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="storage-provider">Storage Provider<a href="#storage-provider" class="hash-link" aria-label="Direct link to Storage Provider" title="Direct link to Storage Provider">​</a></h3><p>In a peer-to-peer network like Bacalhau, storage providers play a crucial role in presenting an upstream storage source. There can be different storage providers available in the network, each with its own way of manifesting the CI to the executor.</p><p>For instance, there can be a posix storage provider that presents the CID as a POSIX filesystem, or a library storage provider that streams the contents of the CID (Content IDentifier) via a library call.</p><p>On the other hand, there can be different executor implementations, such as Docker or WASM, that are responsible for running the job. When a job is submitted to these executors, the executor should select the appropriate storage provider to work with, depending on the implementation.</p><p>For instance, the Docker executor might use the posix storage provider to manifest the CID as a POSIX filesystem, while the WASM executor might use a library storage provider to stream the contents of the CID (Content IDentifier) via a library call.</p><p>Therefore, the storage providers and Executor implementations are loosely coupled, allowing the POSIX and library storage providers to be used across multiple executors, wherever it is deemed appropriate.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="verifier">Verifier<a href="#verifier" class="hash-link" aria-label="Direct link to Verifier" title="Direct link to Verifier">​</a></h3><p>The verifier component is responsible for ensuring the validity of the results produced by the executor and transporting those results back to the requester node. There are two main tasks that the verifier performs:</p><ul><li>checking the results produced by the executor against results produced by other nodes, and, </li><li>transporting those results back to the requester node.</li></ul><p>How the results are checked depends on the nature of the job. For example, if the job is deterministic, the &quot;deterministic hash&quot; verifier can be used to ensure that the results produced by different nodes are the same. However, if the job is non-deterministic, a different approach must be used to check the results.</p><p>Both the compute node and the requester node have a verifier component. The compute node verifier produces a verification proposal based on having run the job, while the requester node verifier collates the proposals from various compute nodes. Once enough proposals have arrived, the requester node verifier decides which compute nodes have actually performed the work and emits events to the network indicating whether the verification proposals are accepted or rejected.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="publisher">Publisher<a href="#publisher" class="hash-link" aria-label="Direct link to Publisher" title="Direct link to Publisher">​</a></h3><p>The publisher is responsible for uploading the final results of a job to a public location where clients can access them. However, before the results can be published, the verification process must be completed to ensure the accuracy and authenticity of the results.</p><p>During the verification process, the raw results are kept private between the compute node and requester node to prevent unauthorized access or copying. Once the verification is complete and the results are deemed valid, the publisher interface takes over the task of uploading the local folder of results to a public location that can be accessed by the wider network.</p><p>The default publisher used is either Estuary, with the published results being stored with a unique content identifier (cid) that can be used to retrieve them. If Estuary is used as the publisher, the results will also be stored on Filecoin. The publisher interface is responsible for ensuring that the published results are accessible and can be read by other nodes on the network.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="job-lifecycle">Job Lifecycle<a href="#job-lifecycle" class="hash-link" aria-label="Direct link to Job Lifecycle" title="Direct link to Job Lifecycle">​</a></h2><p>The job lifecycle involves several steps that are handled by different components of the network, from job submission to jobs download.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="job-submission">Job Submission<a href="#job-submission" class="hash-link" aria-label="Direct link to Job Submission" title="Direct link to Job Submission">​</a></h3><p>Jobs submitted via the Bacalhau CLI are forwarded to a Bacalhau network node at <code>bootstrap.production.bacalhau.org</code> via port 1234 by default. This Bacalhau node will act as the requestor node for the duration of the job lifecycle. Jobs can also be submitted to any requestor node on the Bacalhau network.</p><p>When jobs are submitted to the requestor node, all compute nodes hear of this new job and can choose to <code>bid</code> on it. The job deal will have a <code>concurrency</code> setting, which refers to how many different nodes you may want to run this job. It will also have <code>confidence</code> and <code>min-bids</code> properties.  Confidence is how many verification proposals must agree for the job to be deemed successful. <code>Min-bids</code> is how many bids must have been made before we will choose to accept any.</p><p>The job might also mention the use of <code>volumes</code> (for example some CIDs). The compute node can choose to bid on the job if the data for the volumes resides locally to the compute node, or it can choose to bid anyway. Bacalhau supports the use of external http or exec hooks to decide if a node wants to bid on a job. This means that a node operator can give granular rules about the jobs they are willing to run.</p><p><img loading="lazy" alt="image" src="/assets/images/architecture-bid-on-job-7c64a8dd1e973cf99d718cb59cc2d2b0.jpeg" title="Bacalhau Architecture Bid on Job" width="1152" height="864" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="job-acceptance">Job Acceptance<a href="#job-acceptance" class="hash-link" aria-label="Direct link to Job Acceptance" title="Direct link to Job Acceptance">​</a></h3><p>As bids from compute nodes arrive back at the originating requester node, it can choose which bids to accept and which ones to reject. This can be based on the previous reputation of each compute node, or any other factors the requestor node might take into account (like locality, hardware resources, cost etc). The requestor node will also have the same http or exec hooks to decide if it wants to accept a bid from a given compute node. The <code>min-bids</code> setting is useful to ensure that we don’t accept bids on a first bid first accepted basis.</p><p><img loading="lazy" alt="image" src="/assets/images/architecture-accept-job-bid-c541f3a23a90c2cfb07b47d401b202ca.jpeg" title="Bacalhau Architecture Accept Job Bid" width="1152" height="864" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="job-execution">Job Execution<a href="#job-execution" class="hash-link" aria-label="Direct link to Job Execution" title="Direct link to Job Execution">​</a></h3><p>As accepted bids are received by compute nodes, they will <code>execute</code> the job using the executor for that job, and the storage providers that executor has mapped in.</p><p>For example, a job could use the <code>docker</code> executor, <code>WASM</code> executor or a library storage volumes. This would result in a POSIX mount of the storage into a running container or a WASM style <code>syscall</code> to stream the storage bytes into the WASM runtime. Each executor will deal with storage in a different way, so even though each job mentions the storage volumes, they would both end up with different implementations at runtime.</p><p><img loading="lazy" alt="image" src="/assets/images/architecture-execute-job-2bac1c0560e5a8804b88b118ac04f1f2.jpeg" title="Bacalhau Architecture Execute Job" width="1152" height="864" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="verification">Verification<a href="#verification" class="hash-link" aria-label="Direct link to Verification" title="Direct link to Verification">​</a></h3><p>Once the executor has completed the running of the job, a verification proposal will be generated by the verifier module running on the compute node. The nature of this proposal depends on the module used. For example, the deterministic hash verifier will:</p><ul><li>Calculate a <code>sha256</code> hash of the contents of the results folder</li><li>Encrypt this hash using the public key of the requester node</li><li>Broadcast the encrypted hash over the network<ul><li>Nodes that are NOT the requester node cannot copy the hash because they do not have the requesters private key</li><li>The requester will use it’s private key to decrypt the message and read the hash</li><li>This means that bad actors cannot simply copy the results hash from other nodes</li></ul></li><li>The requester node will wait for enough proposals before comparing the results hashes</li><li>It will then broadcast “results accepted” and “results rejected” events based on it’s decision for verification</li></ul><p>In the case of a deterministic job, a user can guard against malicious compute nodes that join the network, bids and propose wrong results by using <code>--verifier deterministic --min-bids N --concurrency 3</code> (where N is, say, &gt;half of the size  of the network, currently 9). This will require that <em>N</em> bids are received before the requestor node chooses between them randomly. So when you submit WASM jobs (which are deterministic) this can give you a good level of confidence the jobs are evenly spread across nodes and malicious nodes will be, on average, caught out.</p><p>It’s possible to use other types of verification methods by re-implementing the verification interface and using another technique.</p><p><img loading="lazy" alt="image" src="/assets/images/architecture-verification-0ec9f7e4ade22c66791960bbae7f09f3.jpeg" title="Bacalhau Architecture Verification" width="1152" height="864" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="publishing">Publishing<a href="#publishing" class="hash-link" aria-label="Direct link to Publishing" title="Direct link to Publishing">​</a></h3><p>Once verification has resulted in <code>results accepted</code> or <code>results rejected</code> events, the publisher will publish the raw results folder currently residing on the compute node.</p><p>The default publisher is <code>Estuary</code> (if no API key is provided this falls back to the IPFS publisher).  The publisher interface mainly consists of a single function, which has the task of uploading the local results folder somewhere and returning a storage reference to where it has been uploaded.</p><p><img loading="lazy" alt="image" src="/assets/images/architecture-publishing-8f865f05dff72589a09fb378056cbc3a.jpeg" title="Bacalhau Architecture Publishing" width="1152" height="864" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="networking">Networking<a href="#networking" class="hash-link" aria-label="Direct link to Networking" title="Direct link to Networking">​</a></h3><p>It is possible to run Bacalhau completely disconnected from the main Bacalhau network, so that you can run private workloads without risking running on public nodes or inadvertently sharing your data outside of your organization. The isolated network will not connect to the public Bacalhau network nor connect to a public network. Read more on <a href="https://docs.bacalhau.org/next-steps/private-cluster" target="_blank" rel="noopener noreferrer">networking</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="input--output-volumes">Input / Output Volumes<a href="#input--output-volumes" class="hash-link" aria-label="Direct link to Input / Output Volumes" title="Direct link to Input / Output Volumes">​</a></h3><p>A job includes the concept of input and output volumes, and the Docker executor implements support for these. This means you can specify your CIDs, URLs, as input paths and also write results to an output volume. This can be seen by the following example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cid=$(ipfs add file.txt)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bacalhau docker run \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -i ipfs://$cid:/file.txt \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -o apples:/output_folder \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ubuntu \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  bash -c &#x27;cat /file.txt &gt; /output_folder/file.txt&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above example demonstrates an input volume flag <code>-i ipfs://$cid:/file.txt</code>, which mounts the contents of $cid within the docker container at location <code>/file.txt</code> (root).</p><p>Output volumes are mounted to the Docker container at the location specified. In the example above, any content written to <code>/output_folder</code> will be made available within the apples folder in the job results CID.</p><p>Once the job has run on the executor, the contents of <code>stdout</code> and <code>stderr</code> will be added to any named output volumes the job has used (in this case apples), and all those entities will be packaged into the results folder which is then published to your storage location via the verifier.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/bacalhau-project/docs.bacalhau.org/blob/main/docs/getting-started/architecture.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-04-14T11:06:52.000Z">Apr 14, 2023</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Home</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/getting-started/installation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Installation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#system-components" class="table-of-contents__link toc-highlight">System Components</a></li><li><a href="#core-components" class="table-of-contents__link toc-highlight">Core Components</a><ul><li><a href="#requester-node" class="table-of-contents__link toc-highlight">Requester node</a></li><li><a href="#compute-node" class="table-of-contents__link toc-highlight">Compute node</a></li></ul></li><li><a href="#interface" class="table-of-contents__link toc-highlight">Interface</a><ul><li><a href="#transport" class="table-of-contents__link toc-highlight">Transport</a></li><li><a href="#executor" class="table-of-contents__link toc-highlight">Executor</a></li><li><a href="#storage-provider" class="table-of-contents__link toc-highlight">Storage Provider</a></li><li><a href="#verifier" class="table-of-contents__link toc-highlight">Verifier</a></li><li><a href="#publisher" class="table-of-contents__link toc-highlight">Publisher</a></li></ul></li><li><a href="#job-lifecycle" class="table-of-contents__link toc-highlight">Job Lifecycle</a><ul><li><a href="#job-submission" class="table-of-contents__link toc-highlight">Job Submission</a></li><li><a href="#job-acceptance" class="table-of-contents__link toc-highlight">Job Acceptance</a></li><li><a href="#job-execution" class="table-of-contents__link toc-highlight">Job Execution</a></li><li><a href="#verification" class="table-of-contents__link toc-highlight">Verification</a></li><li><a href="#publishing" class="table-of-contents__link toc-highlight">Publishing</a></li><li><a href="#networking" class="table-of-contents__link toc-highlight">Networking</a></li><li><a href="#input--output-volumes" class="table-of-contents__link toc-highlight">Input / Output Volumes</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/getting-started/installation">Getting Started</a></li><li class="footer__item"><a href="https://docs.bacalhau.org/examples/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Examples</a></li><li class="footer__item"><a href="https://docs.bacalhau.org/faqs" target="_blank" rel="noopener noreferrer" class="footer__link-item">FAQs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/bacalhau-project/bacalhau/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://filecoin.io/slack" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Develop/Contribute</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/bacalhau-project/bacalhau" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/bacalhau-project/bacalhau/releases/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Changelog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.bacalhau.org/community/ways-to-contribute/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Ways To Contribute<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Socials</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/channel/UCUgZfGPLRxnxpUK3tSLsmMg" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/BacalhauProject" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://bacalhau.substack.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog/Newsletter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Bacalhau, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a458cb06.js"></script>
<script src="/assets/js/main.d662fde7.js"></script>
</body>
</html>