<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-examples/case-studies/duckdb-log-processing/index" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">index | Bacalhau Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.bacalhau.org/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://docs.bacalhau.org/img/logo.png"><meta data-rh="true" property="og:url" content="https://docs.bacalhau.org/examples/case-studies/duckdb-log-processing/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="Bacalhau Docs contains ifnormation for fast, cost efficient, and secure computation by explaining how to run jobs where the data is generated and stored."><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="index | Bacalhau Docs"><meta data-rh="true" name="description" content="DuckDB is an embedded SQL database tool that is designed to analyze data without external dependencies or state, that can be embedded locally on any machine."><meta data-rh="true" property="og:description" content="DuckDB is an embedded SQL database tool that is designed to analyze data without external dependencies or state, that can be embedded locally on any machine."><link data-rh="true" rel="icon" href="/img/logo.png"><link data-rh="true" rel="canonical" href="https://docs.bacalhau.org/examples/case-studies/duckdb-log-processing/"><link data-rh="true" rel="alternate" href="https://docs.bacalhau.org/examples/case-studies/duckdb-log-processing/" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.bacalhau.org/examples/case-studies/duckdb-log-processing/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://15JCWQAGM1-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-10GYL172V9"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-10GYL172V9",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Bacalhau Docs" href="/opensearch.xml">

<script src="https://plausible.io/js/plausible.js" async defer="defer" data-domain="docs.bacalhau.org"></script><link rel="stylesheet" href="/assets/css/styles.6d899b17.css">
<link rel="preload" href="/assets/js/runtime~main.b5bb54b5.js" as="script">
<link rel="preload" href="/assets/js/main.14ac0b9d.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Bacalhau Docs Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Bacalhau Docs Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Bacalhau Docs</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/bacalhau-project/bacalhau" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Home</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/getting-started">Getting Started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting Started&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/docker-workload-onboarding">Onboard Docker Workload</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/wasm-workload-onboarding">Onboard WebAssembly Workload</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting-started/resources">Specifying Hardware Requirements</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/examples">Examples</a><button aria-label="Toggle the collapsible sidebar category &#x27;Examples&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/category/case-studies">Case Studies</a><button aria-label="Toggle the collapsible sidebar category &#x27;Case Studies&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/examples/case-studies/duckdb-log-processing/">DuckDB</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/category/workload-onboarding">Workload Onboarding</a><button aria-label="Toggle the collapsible sidebar category &#x27;Workload Onboarding&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/category/data-engineering">Data Engineering</a><button aria-label="Toggle the collapsible sidebar category &#x27;Data Engineering&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/category/model-inference">Model Inference</a><button aria-label="Toggle the collapsible sidebar category &#x27;Model Inference&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/category/model-training">Model Training</a><button aria-label="Toggle the collapsible sidebar category &#x27;Model Training&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/category/molecular-dynamics">Molecular Dynamics</a><button aria-label="Toggle the collapsible sidebar category &#x27;Molecular Dynamics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/topic-guides/">Topic Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Topic Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/data-ingestion">Data Ingestion</a><button aria-label="Toggle the collapsible sidebar category &#x27;Data Ingestion&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/process">Process</a><button aria-label="Toggle the collapsible sidebar category &#x27;Process&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/running-node">Running a Node</a><button aria-label="Toggle the collapsible sidebar category &#x27;Running a Node&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/references">References</a><button aria-label="Toggle the collapsible sidebar category &#x27;References&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/troubleshooting">FAQS</a><button aria-label="Toggle the collapsible sidebar category &#x27;FAQS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/integration">Integration</a><button aria-label="Toggle the collapsible sidebar category &#x27;Integration&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/community">Community</a><button aria-label="Toggle the collapsible sidebar category &#x27;Community&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/examples"><span itemprop="name">Examples</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/category/case-studies"><span itemprop="name">Case Studies</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">DuckDB</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>index</h1></header><p>DuckDB is an embedded SQL database tool that is designed to analyze data without external dependencies or state, that can be embedded locally on any machine.</p><p>Because DuckDB allows you to process and store data such as Parquet files and text logs, DuckDB can be an invaluable tool in analyzing system created data such as logs while still allowing you to use SQL as a first-class way to interact with it.</p><p>However, many organizations only want to present DuckDB on local interfaces for security and compliance  purposes, so having a central system that can interact with embedded DuckDBs would not be acceptable. Bacalhau + DuckDB provides a distributed way to execute many queries against local logs, without having to move the files at all.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="problem">Problem<a href="#problem" class="hash-link" aria-label="Direct link to Problem" title="Direct link to Problem">​</a></h2><p>With data being generated everywhere, it can be a challenge to centralize and process the information before getting insights. Moving data to a lake can be time consuming, costly, and insecure; often just moving the data risks enormous data protection fines.</p><p>Further, the sheer number of log files alone being generated from servers, IoT devices, embedded machines, and more present a huge surface area for managing generated data. As files are written to a local data store, organizations are faced with either building remote connectivity tooling to access the files in place, or pushing these files into a data lake costing both time and money.</p><p>Ideally, a users would be able to gain insights from the remote files WITHOUT having to centralize first. This is where Bacalhau and DuckDB can step in.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-bacalhau-to-execute-duckdb-processing">Using Bacalhau to Execute DuckDB Processing<a href="#using-bacalhau-to-execute-duckdb-processing" class="hash-link" aria-label="Direct link to Using Bacalhau to Execute DuckDB Processing" title="Direct link to Using Bacalhau to Execute DuckDB Processing">​</a></h2><p>In order to speed results and deliver more cost-effective processing of log files generated, we can use Bacalhau and DuckDB to run directly to the nodes.</p><p>The flow looks like the following:</p><ol><li>Execute a command against the network to execute “local to machine” queries against the set of nodes with log files on them</li><li>Return the results of the queries that require immediate action (e.g. emergency alerts)</li><li>Archive the existing logs into cold storage.</li></ol><p>This is laid out in the architecture below.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tools-used">Tools Used<a href="#tools-used" class="hash-link" aria-label="Direct link to Tools Used" title="Direct link to Tools Used">​</a></h2><ul><li>DuckDB</li><li>Docker</li><li>Python</li><li>Terraform</li><li>gcloud CLI</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="try-out-thing">Try out Thing<a href="#try-out-thing" class="hash-link" aria-label="Direct link to Try out Thing" title="Direct link to Try out Thing">​</a></h3><p>Follow the steps below to set up log processing and storage for 3 VMs in different regions or zones these VMs produce logs:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-set-up-a-fake-log-creating-job">Step 1: Set up a “fake log creating” job<a href="#step-1-set-up-a-fake-log-creating-job" class="hash-link" aria-label="Direct link to Step 1: Set up a “fake log creating” job" title="Direct link to Step 1: Set up a “fake log creating” job">​</a></h4><ul><li>Output something that looks like real logs -</li><li>It should be compatible with this - <a href="https://tersesystems.com/blog/2023/03/04/ad-hoc-structured-log-analysis-with-sqlite-and-duckdb/" target="_blank" rel="noopener noreferrer">https://tersesystems.com/blog/2023/03/04/ad-hoc-structured-log-analysis-with-sqlite-and-duckdb/</a></li><li>Each fake log entry should look something like this:</li></ul><div class="language-JSON codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-JSON codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;id&quot;: &quot;&lt;UNIQUE ID&gt;&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;@timestamp&quot;: &quot;&lt;TIME STAMP IN ISO9660&gt;&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;@version&quot;: &quot;1.1&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;message&quot;: &quot;ServiceName [Category] Message&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>For service name - just use one of “Auth”, “AppStack”, “Database” - each one should produce one per 5 seconds</li><li>For category, select one from <!-- -->[INFO]<!-- -->, <!-- -->[WARN]<!-- -->, <!-- -->[CRITICAL]<!-- -->, <!-- -->[SECURITY]</li><li>For message - just output a random combination of words from a <a href="https://github.com/dwyl/english-words/files/3086945/clean_words_alpha.txt" target="_blank" rel="noopener noreferrer">word list</a> - so each message should be like “dog cheese cow car sky”. Have it be 5 words each.</li><li>This needs to be running reliably - so have the script run in system.d</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-configure-logrotate-on-the-machine">Step 2 Configure logrotate on the machine<a href="#step-2-configure-logrotate-on-the-machine" class="hash-link" aria-label="Direct link to Step 2 Configure logrotate on the machine" title="Direct link to Step 2 Configure logrotate on the machine">​</a></h4><ul><li>Create a new logrotate configuration file at <strong><code>/etc/logrotate.d/my_logs</code></strong> with the content:</li></ul><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">/path/to/logs/*.log </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">hourly</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rotate </span><span class="token number">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">missingok</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">notifempty</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">compress</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>Each time the log rotates - put it into a special directory <strong><code>/var/logs/raw_logs</code></strong> or something. (this is a setting in log rotate - where you output the rotate to)</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-3-the-bacalhau-job">Step 3: The Bacalhau Job<a href="#step-3-the-bacalhau-job" class="hash-link" aria-label="Direct link to Step 3: The Bacalhau Job" title="Direct link to Step 3: The Bacalhau Job">​</a></h4><ul><li>On a second machine, once per hour, trigger a job to run across all nodes identified across regions</li><li>Pass the log path to the job spec. (Use the local mount feature (can’t use it currently))</li><li>This job should do the following:<ul><li>If the file is not present in raw_logs, write information to stdout: “{ warning: raw_logs_not_found, date: &lt;-ISO9660 Timestamp-&gt;}” - and quit</li><li>If file is present:</li></ul></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-3a-use-duckdb-to-process-the-logs"><strong>Step 3a: Use DuckDB to process the logs:</strong><a href="#step-3a-use-duckdb-to-process-the-logs" class="hash-link" aria-label="Direct link to step-3a-use-duckdb-to-process-the-logs" title="Direct link to step-3a-use-duckdb-to-process-the-logs">​</a></h4><ul><li>Use a container (like from our existing example) that has DuckDB inside it - <a href="https://docs.bacalhau.org/examples/data-engineering/DuckDB/" target="_blank" rel="noopener noreferrer">https://docs.bacalhau.org/examples/data-engineering/DuckDB/</a></li><li>We should NOT use David Gasquez’s current one - we should use the generic one.</li><li>Inside the container, use a command that loads the file - e.g. <code>“duckdb -s &quot;select count(*) from &#x27;0_yellow_taxi_trips.parquet&#x27;”</code></li><li>Except, we want to select only a subset of the files e.g. <code>“duckdb -s &quot;select count(*) from &#x27;0_yellow_taxi_trips.parquet&#x27; contains(&#x27;abc&#x27;,&#x27;a&#x27;)”</code></li><li>Output the match to a file on the disk - <code>/tmp/Region-Zone-NodeName-Security-yyyymmddhhmm.json</code></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-3b---compress-the-file"><strong>Step 3b - Compress the file:</strong><a href="#step-3b---compress-the-file" class="hash-link" aria-label="Direct link to step-3b---compress-the-file" title="Direct link to step-3b---compress-the-file">​</a></h4><ul><li><code>/tmp/Region-Zone-NodeName-SECURITY-yyyymmddhhmm.json.gz</code></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-3c---push-the-file-to-an-s3-bucket"><strong>Step 3c - Push the file to an S3 bucket:</strong><a href="#step-3c---push-the-file-to-an-s3-bucket" class="hash-link" aria-label="Direct link to step-3c---push-the-file-to-an-s3-bucket" title="Direct link to step-3c---push-the-file-to-an-s3-bucket">​</a></h4><ul><li>Push the processed logs to s3 (s3 push functionality isn’t implemented yet - just use a standard aws CLI command - figure out with Walid how to do credentials)</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-3d---compress-the-raw-log-file"><strong>Step 3d - Compress the raw log file</strong><a href="#step-3d---compress-the-raw-log-file" class="hash-link" aria-label="Direct link to step-3d---compress-the-raw-log-file" title="Direct link to step-3d---compress-the-raw-log-file">​</a></h4><ul><li><code>/tmp/Region-Zone-NodeName-RAW-yyyymmddhhmm.json.gz</code></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-3e---push-the-compressed-raw-log-to-iceberg"><strong>Step 3e - Push the compressed raw log to Iceberg</strong><a href="#step-3e---push-the-compressed-raw-log-to-iceberg" class="hash-link" aria-label="Direct link to step-3e---push-the-compressed-raw-log-to-iceberg" title="Direct link to step-3e---push-the-compressed-raw-log-to-iceberg">​</a></h4><ul><li>Just use standard Iceberg API - talk with Walid about</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="step-3f"><strong>Step 3f:</strong><a href="#step-3f" class="hash-link" aria-label="Direct link to step-3f" title="Direct link to step-3f">​</a></h4><ul><li>Delete the raw log file</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/bacalhau-project/docs.bacalhau.org/blob/main/docs/examples/case-studies/duckdb-log-processing/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-09-25T09:32:32.000Z">Sep 25, 2023</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/category/case-studies"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Case Studies</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/category/workload-onboarding"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Workload Onboarding</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#problem" class="table-of-contents__link toc-highlight">Problem</a></li><li><a href="#using-bacalhau-to-execute-duckdb-processing" class="table-of-contents__link toc-highlight">Using Bacalhau to Execute DuckDB Processing</a></li><li><a href="#tools-used" class="table-of-contents__link toc-highlight">Tools Used</a><ul><li><a href="#try-out-thing" class="table-of-contents__link toc-highlight">Try out Thing</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/getting-started/installation">Getting Started</a></li><li class="footer__item"><a href="https://docs.bacalhau.org/examples/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Examples</a></li><li class="footer__item"><a href="https://docs.bacalhau.org/troubleshooting/faqs" target="_blank" rel="noopener noreferrer" class="footer__link-item">FAQs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/bacalhau-project/bacalhau/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/bacalhauproject/shared_invite/zt-1sihp4vxf-TjkbXz6JRQpg2AhetPzYYQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Develop/Contribute</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/bacalhau-project/bacalhau" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/bacalhau-project/bacalhau/releases/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Changelog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.bacalhau.org/community/ways-to-contribute/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Ways To Contribute<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Socials</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/channel/UCUgZfGPLRxnxpUK3tSLsmMg" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/BacalhauProject" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://bacalhau.substack.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog/Newsletter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Bacalhau, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b5bb54b5.js"></script>
<script src="/assets/js/main.14ac0b9d.js"></script>
</body>
</html>