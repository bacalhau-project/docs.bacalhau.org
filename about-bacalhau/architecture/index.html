<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-about-bacalhau/architecture">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Architecture | Bacalhau Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.bacalhau.org//about-bacalhau/architecture"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Architecture | Bacalhau Docs"><meta data-rh="true" name="description" content="Bacalhau operates as a peer-to-peer network of nodes where each node has both a requestor and compute component.  To interact with the Bacalhau network, Bacalhau CLI requests are sent to a node in the network (via JSON over HTTP), which then broadcasts messages over the transport layer to other nodes in the network.  All other nodes in the network are connected to the transport layer and as such have a shared view of the world."><meta data-rh="true" property="og:description" content="Bacalhau operates as a peer-to-peer network of nodes where each node has both a requestor and compute component.  To interact with the Bacalhau network, Bacalhau CLI requests are sent to a node in the network (via JSON over HTTP), which then broadcasts messages over the transport layer to other nodes in the network.  All other nodes in the network are connected to the transport layer and as such have a shared view of the world."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.bacalhau.org//about-bacalhau/architecture"><link data-rh="true" rel="alternate" href="https://docs.bacalhau.org//about-bacalhau/architecture" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.bacalhau.org//about-bacalhau/architecture" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://VLYBZRSZSU-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D6NP6P151C"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-D6NP6P151C",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Bacalhau Docs" href="/opensearch.xml">
<script src="https://plausible.io/js/plausible.js" async defer="defer" data-domain="docs.bacalhau.org"></script><link rel="stylesheet" href="/assets/css/styles.fa4aab7f.css">
<link rel="preload" href="/assets/js/runtime~main.e6708aa3.js" as="script">
<link rel="preload" href="/assets/js/main.686e5817.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Bacalhau Docs Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Bacalhau Docs Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Bacalhau Docs</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/filecoin-project/bacalhau" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Home</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/about-bacalhau/architecture">About Bacalhau</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/about-bacalhau/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/about-bacalhau/compute-landscape">Landscape</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/getting-started/installation">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/next-steps/parallel-workloads">Next Steps</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/troubleshooting/debugging">Troubleshooting</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/examples/">Examples</a><button aria-label="Toggle the collapsible sidebar category &#x27;Examples&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/running-node/quick-start">Running a Node</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/all-flags">CLI Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/faqs">FAQs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/development">Development</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/community/style-guide">Community</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">About Bacalhau</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Architecture</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Architecture</h1><p>Bacalhau operates as a peer-to-peer network of nodes where each node has both a requestor and compute component.  To interact with the Bacalhau network, Bacalhau CLI requests are sent to a node in the network (via JSON over HTTP), which then broadcasts messages over the transport layer to other nodes in the network.  All other nodes in the network are connected to the transport layer and as such have a shared view of the world.</p><p><img loading="lazy" alt="image" src="/assets/images/architecture-purpose-f192f229e16abe177d77f146ab2dca30.jpeg" width="1152" height="864" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="system-components">System Components<a class="hash-link" href="#system-components" title="Direct link to heading">​</a></h2><p>Bacalhau&#x27;s architecture is divided among the following core components and interfaces: </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="transport-interface">Transport (interface)<a class="hash-link" href="#transport-interface" title="Direct link to heading">​</a></h3><p>The transport component is responsible for connecting different Bacalhau nodes in the peer to peer network. Its job is to broadcast messages about jobs as they are created, bid upon and executed by compute nodes.</p><p>In addition to handling the distribution of messages to other nodes, the transport component is also responsible for handling the identity of an individual Bacalhau node.</p><p>The main implementation of the transport interface in a production Bacalhau network is the <a href="https://libp2p.io/" target="_blank" rel="noopener noreferrer">libp2p</a> transport.  This uses the <a href="https://docs.libp2p.io/concepts/publish-subscribe/" target="_blank" rel="noopener noreferrer">GossipSub</a> handler to distribute job messages to other nodes on the network.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="requester-node-component">Requester node (component)<a class="hash-link" href="#requester-node-component" title="Direct link to heading">​</a></h3><p>The requestor node is responsible for handling requests from clients using JSON over HTTP and is the main custodian of jobs submitted to it.</p><p>When you submit a job to a given Requestor node, it handles the process of broadcasting that job to the network and then accepting or rejecting the various bids that will come back in for that job. There is only ever a single requestor node for a given job -- the requestor node that job was originally submitted to.</p><p>Once compute nodes have executed the job, they will produce verification proposals, of which the requester node will collate and combine when enough have been proposed. At this point, the proposals will be <code>accepted</code> or <code>rejected</code>, and the compute nodes will then publish their raw results.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="compute-node-component">Compute node (component)<a class="hash-link" href="#compute-node-component" title="Direct link to heading">​</a></h3><p>When a new job is seen on the network, the Compute node will decide whether it wants to <code>bid</code> on that job or not.  If a bid is made and subsequently accepted by the requester node, a <code>bid accepted</code> event will then trigger the Compute node to run the job using its collection of <code>executors</code> (each of which in turn has a collection of <code>storage providers</code>).</p><p>Once the executor has run the job and has produced some results, the Compute node will then produce a verification proposal which the requester node will collate alongside proposals from other compute nodes that ran the same job. These proposals will then be accepted or rejected which will result in the compute node then publishing the raw results (via the publisher interface). The Compute node has a collection of named executors, verifiers, and publishers -- it will pick the most appropriate ones based on the job specifications.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="executor-interface">Executor (interface)<a class="hash-link" href="#executor-interface" title="Direct link to heading">​</a></h3><p>The Executor is what runs the job and checks for the locality of storage used by a job. It handles presenting the input and output storage volumes into the job when it is run.</p><p>Storage means something entirely different between Docker and WebAssembly (wasm), so if a job mentions “use this IPFS cid”, it will result in two different storage providers being used. This choice depends the executor used on the job.</p><p>Put another way - the executor has two main tasks:</p><ul><li>Present the storage volumes in a way that is appropriate for the executor.</li><li>Run the job.</li></ul><p>When it’s finished running the job, the executor will combine <code>stdout</code>, <code>stderr</code>, and named output volumes into a results folder. This results folder is then used to create the verification proposal which is sent off to the requester. Once <code>results accepted</code> or <code>results rejected</code> events are seen - this results folder is then sent off to the publisher to be published.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="storage-provider-interface">Storage Provider (interface)<a class="hash-link" href="#storage-provider-interface" title="Direct link to heading">​</a></h3><p>Storage providers are responsible for presenting some upstream storage source (e.g. ipfs cid) into an executor in an opinionated way.</p><p>For example, we might have the following two storage providers:</p><ul><li>IPFS posix - a storage provider that manifests a CID as a POSIX filesystem</li><li>IPFS library - a storage provider that streams the contents of a CID via a library call</li></ul><p>And we might have the following two executor implementations:</p><ul><li>Docker - run docker containers</li><li>WASM - run WASM binaries</li></ul><p>If we submit a job with a volume of type <code>ipfs</code> to both executors, it should result in the Docker executor using the <code>IPFS posix</code> storage provider and the WASM executor using the <code>IPFS library</code> provider.</p><p>As such, an executor implementation will contain the storage providers it can work with and they are loosely coupled, e.g. the IPFS posix &amp; library storage providers can be used across multiple executors where appropriate.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="verifier-interface">Verifier (interface)<a class="hash-link" href="#verifier-interface" title="Direct link to heading">​</a></h3><p>The verifier takes over once the executor has run the job. Its main two tasks are to check the results produced by the executor (against results produced by other nodes) and to transport those results back to the requester node.</p><p>How the results are checked depend on the nature of the job.  For example, if the job is deterministic, the “deterministic hash” verifier can be used. If the job is non-deterministic, another approach must be used.</p><p>The verifier exists on both the compute node and requester node - the task of the compute node verifier is to produce a verification proposal based on having run a job. The task of the requester node verifier is to collate the proposals from various compute nodes, and when enough proposals have arrived, to decide on which compute nodes have actually performed the work. Once it has decided, it will emit events to the network <code>accepting</code> or <code>rejecting</code> the verification proposals.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="publisher-interface">Publisher (interface)<a class="hash-link" href="#publisher-interface" title="Direct link to heading">​</a></h3><p>Once verification has been complete, the publisher will handle uploading the raw results to a place that clients can read from. Its important to make a distinction between verification proposals and published results.  Before verification has happened, the published results need to remain private between the compute node that ran the job and the requester node looking after that job. This is to prevent compute nodes simply copying the results produced by other nodes.</p><p>The publisher interface is responsible for uploading the local folder of results to somewhere that can be read by the rest of the world. The default publisher is either Estuary (if an API key has been provided) or IPFS.  In both cases, the published results of a job will end up on IPFS with a cid that can be used to read them.  If Estuary is used as the publisher, then the results will also end up on Filecoin.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="job-lifecycle">Job Lifecycle<a class="hash-link" href="#job-lifecycle" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="job-submission">Job Submission<a class="hash-link" href="#job-submission" title="Direct link to heading">​</a></h3><p>Jobs submitted via the Bacalhau CLI are forwarded to a Bacalhau network node at <code>bootstrap.production.bacalhau.org</code> via port 1234 by default. This Bacalhau node will act as the requestor node for the duration of the job lifecycle. Jobs can also be submitted to any requestor node on the Bacalhau network.</p><p>When jobs are submitted to the requestor node, all compute nodes hear of this new job and can choose to <code>bid</code> on it. The job deal will have a <code>concurrency</code> setting, which refers to how many different nodes you may want to run this job. It will also have <code>confidence</code> and <code>min-bids</code> properties.  Confidence is how many verification proposals must agree for the job to be deemed successful. <code>Min-bids</code> is how many bids must have been made before we will choose to accept any.</p><p>The job might also mention the use of <code>volumes</code> (for example some IPFS CIDs). The compute node can choose to bid on the job if the data for the volumes resides locally to the compute node, or it can choose to bid anyway. Bacalhau supports the use of external http or exec hooks to decide if a node wants to bid on a job. This means that a node operator can give granular rules about the jobs they are willing to run.</p><p><img loading="lazy" alt="image" src="/assets/images/architecture-bid-on-job-7c64a8dd1e973cf99d718cb59cc2d2b0.jpeg" width="1152" height="864" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="job-acceptance">Job Acceptance<a class="hash-link" href="#job-acceptance" title="Direct link to heading">​</a></h3><p>As bids from compute nodes arrive back at the originating requester node, it can choose which bids to accept and which ones to reject. This can be based on the previous reputation of each compute node, or any other factors the requestor node might take into account (like locality, hardware resources, cost etc). The requestor node will also have the same http or exec hooks to decide if it wants to accept a bid from a given compute node. The <code>min-bids</code> setting is useful to ensure that we don’t accept bids on a first bid first accepted basis.</p><p><img loading="lazy" alt="image" src="/assets/images/architecture-accept-job-bid-c541f3a23a90c2cfb07b47d401b202ca.jpeg" width="1152" height="864" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="job-execution">Job Execution<a class="hash-link" href="#job-execution" title="Direct link to heading">​</a></h3><p>As accepted bids are received by compute nodes, they will <code>execute</code> the job using the executor for that job, and the storage providers that executor has mapped in.</p><p>For example, a job could use the <code>docker</code> executor and <code>ipfs</code> storage volumes. This would result in a POSIX mount of the IPFS storage into a running container. Alternately, a job could use the <code>WASM</code> executor and “ipfs” storage volumes. This would result in a WASM style <code>syscall</code> to stream the storage bytes into the WASM runtime. Each executor will deal with storage in a different way, so even though each job mentions <code>ipfs</code> storage volumes, they would both end up with different implementations at runtime.</p><p><img loading="lazy" alt="image" src="/assets/images/architecture-execute-job-2bac1c0560e5a8804b88b118ac04f1f2.jpeg" width="1152" height="864" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="verification">Verification<a class="hash-link" href="#verification" title="Direct link to heading">​</a></h3><p>Once the executor has completed the running of the job, a verification proposal will be generated by the verifier module running on the compute node. The nature of this proposal depends on the module used. For example, the deterministic hash verifier will:</p><ul><li>Calculate a <code>sha256</code> hash of the contents of the results folder</li><li>Encrypt this hash using the public key of the requester node</li><li>Broadcast the encrypted hash over the network<ul><li>Nodes that are NOT the requester node cannot copy the hash because they do not have the requesters private key</li><li>The requester will use it’s private key to decrypt the message and read the hash</li><li>This means that bad actors cannot simply copy the results hash from other nodes</li></ul></li><li>The requester node will wait for enough proposals before comparing the results hashes</li><li>It will then broadcast “results accepted” and “results rejected” events based on it’s decision for verification</li></ul><p>It’s possible to use other types of verification methods by re-implementing the verification interface and using another technique.</p><p><img loading="lazy" alt="image" src="/assets/images/architecture-verification-0ec9f7e4ade22c66791960bbae7f09f3.jpeg" width="1152" height="864" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="publishing">Publishing<a class="hash-link" href="#publishing" title="Direct link to heading">​</a></h3><p>Once verification has resulted in <code>results accepted</code> or <code>results rejected</code> events, the publisher will publish the raw results folder currently residing on the compute node.</p><p>The default publisher is <code>Estuary</code> (if no API key is provided this falls back to the IPFS publisher).  The publisher interface mainly consists of a single function, which has the task of uploading the local results folder somewhere and returning a storage reference to where it has been uploaded.</p><p><img loading="lazy" alt="image" src="/assets/images/architecture-publishing-8f865f05dff72589a09fb378056cbc3a.jpeg" width="1152" height="864" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="networking">Networking<a class="hash-link" href="#networking" title="Direct link to heading">​</a></h3><p>Jobs should only require dependencies that are baked into their Docker images and the input files mounted from IPFS in order to produce their output, therefore egress access to the network is currently disabled.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="input--output-volumes">Input / Output Volumes<a class="hash-link" href="#input--output-volumes" title="Direct link to heading">​</a></h3><p>A job includes the concept of input and output volumes, and the Docker executor implements support for these. This means you can specify ipfs CIDs and input paths and also write results to an output volume. This can be seen by the following example:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cid=$(ipfs add file.txt)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bacalhau docker run \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -v $cid:/file.txt \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  -o apples:/output_folder \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  ubuntu \</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  bash -c &#x27;cat /file.txt &gt; /output_folder/file.txt&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above example demonstrates an input volume flag <code>-v $cid:/file.txt</code>, which mounts the contents of $cid within the docker container at location <code>/file.txt</code> (root).</p><p>Output volumes are mounted to the Docker container at the location specified. In the example above, any content written to <code>/output_folder</code> will be made available within the apples folder in the job results CID.</p><p>Once the job has run on the executor, the contents of <code>stdout</code> and <code>stderr</code> will be added to any named output volumes the job has used (in this case apples), and all those entities will be packaged into the results folder which is then published to IPFS via the verifier.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/bacalhau-project/docs.bacalhau.org/blob/main/docs/about-bacalhau/architecture.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-02-08T12:13:19.000Z">Feb 8, 2023</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Home</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/about-bacalhau/compute-landscape"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Landscape</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#system-components" class="table-of-contents__link toc-highlight">System Components</a><ul><li><a href="#transport-interface" class="table-of-contents__link toc-highlight">Transport (interface)</a></li><li><a href="#requester-node-component" class="table-of-contents__link toc-highlight">Requester node (component)</a></li><li><a href="#compute-node-component" class="table-of-contents__link toc-highlight">Compute node (component)</a></li><li><a href="#executor-interface" class="table-of-contents__link toc-highlight">Executor (interface)</a></li><li><a href="#storage-provider-interface" class="table-of-contents__link toc-highlight">Storage Provider (interface)</a></li><li><a href="#verifier-interface" class="table-of-contents__link toc-highlight">Verifier (interface)</a></li><li><a href="#publisher-interface" class="table-of-contents__link toc-highlight">Publisher (interface)</a></li></ul></li><li><a href="#job-lifecycle" class="table-of-contents__link toc-highlight">Job Lifecycle</a><ul><li><a href="#job-submission" class="table-of-contents__link toc-highlight">Job Submission</a></li><li><a href="#job-acceptance" class="table-of-contents__link toc-highlight">Job Acceptance</a></li><li><a href="#job-execution" class="table-of-contents__link toc-highlight">Job Execution</a></li><li><a href="#verification" class="table-of-contents__link toc-highlight">Verification</a></li><li><a href="#publishing" class="table-of-contents__link toc-highlight">Publishing</a></li><li><a href="#networking" class="table-of-contents__link toc-highlight">Networking</a></li><li><a href="#input--output-volumes" class="table-of-contents__link toc-highlight">Input / Output Volumes</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/getting-started/installation">Getting Started</a></li><li class="footer__item"><a href="https://docs.bacalhau.org/examples/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Examples</a></li><li class="footer__item"><a href="https://docs.bacalhau.org/faqs" target="_blank" rel="noopener noreferrer" class="footer__link-item">FAQs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/filecoin-project/bacalhau/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://filecoin.io/slack" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Develop/Contribute</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/filecoin-project/bacalhau" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/filecoin-project/bacalhau/releases/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Changelog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docs.bacalhau.org/community/ways-to-contribute/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Ways To Contribute<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Socials</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/channel/UCUgZfGPLRxnxpUK3tSLsmMg" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/BacalhauProject" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://bacalhau.substack.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog/Newsletter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Bacalhau, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.e6708aa3.js"></script>
<script src="/assets/js/main.686e5817.js"></script>
</body>
</html>